<?xml version="1.0" encoding="utf-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:bibi="http://xmlns.jcp.org/jsf/composite/bibi"
	template="/view/templates/template.xhtml">

	<ui:param name="page" value="category_browser" />

	<ui:define name="content">

		<h:form id="form_category_search">

			<h:panelGroup layout="block" styleClass="input-group">

				<h:inputText id="input_category_search_term"
					value="#{categoryBrowser.categorySearch.searchTerm}"
					styleClass="form-control" title="#{msg['search_term']}" />

				<h:commandButton id="button_search_category"
					value="#{msg['search']}"
					action="#{categoryBrowser.searchCategories()}"
					styleClass="btn btn-primary" />

			</h:panelGroup>

		</h:form>
		
		<h:panelGroup layout="block" styleClass="XXX" binding="#{categoryBrowser.categoryTree}" />
		
		<!-- <h:form id="form_category_tree">

			<ui:repeat value="#{categoryBrowser.categories}" var="category">

				<h:panelGroup layout="block" styleClass="XXX">
					<h:commandLink id="link_select_category" value="#{category.name}"
						action="#{categoryBrowser.selectCategory(category)}" />
					<h:commandButton id="button_show_subcategories" value="!SUBCATEGROIES!" action="#{}" />

					<h:panelGroup layout="block" style="margin-left: 3rem;">
						
						<ui:repeat value="#{category.children}" var="subcategory">

						<h:panelGroup layout="block" styleClass="XXX">
							<h:commandLink id="link_select_category" value="#{subcategory.name}"
								action="#{categoryBrowser.selectCategory(subcategory)}" />
							<h:commandButton id="button_show_subcategories" value="!SUBCATEGROIES!" action="#{}" />


						</h:panelGroup>

					</ui:repeat>
					
					</h:panelGroup>
					
					<bibi:branch value="#{category.children}" />

				</h:panelGroup>

			</ui:repeat>

		</h:form> -->

		<h:panelGrid layout="block" styleClass="container-fluid"
			rendered="#{categoryBrowser.currentCategory != null}">

			<h:form id="form_category_controls">

				<h:inputText id="input_category_name"
					value="#{categoryBrowser.currentCategory.name}"
					readonly="#{!categoryBrowser.writableCategoryName()}"
					styleClass="readonly-as-plain-text form-control">
					<f:validateLength minimum="1" maximum="100" />
				</h:inputText>

				<h:inputTextarea id="input_category_description"
					value="#{categoryBrowser.currentCategory.description}"
					readonly="#{!categoryBrowser.writableCategoryDescription()}"
					styleClass="readonly-as-plain-text form-control" />

				<h:commandButton id="button_save_category" value="!SAVE CHANGES!"
					action="#{categoryBrowser.saveCategory()}"
					styleClass="btn btn-outline-secondary" />

				<h:commandButton id="button_delete_category"
					value="!DELETE_CATEGORY!"
					action="#{categoryBrowser.deleteCategory()}"
					styleClass="btn btn-outline-danger" />

				<h:commandButton id="button_create_category"
					value="!CREATE CATEGORY!"
					action="#{categoryBrowser.createCategory()}"
					styleClass="btn btn-outline-primary" />

			</h:form>

			<bibi:paginatedList value="#{categoryBrowser}" styleClass="mt-5">

				<h:column>
					<f:facet name="header">#{msg['medium_attribute.title']}</f:facet>

					<bibi:columnContent>
						<h:link value="#{item.title}"
							outcome="/view/public/medium.xhtml?id=#{item.id}" />
					</bibi:columnContent>
				</h:column>

				<h:column>
					<f:facet name="header">#{msg['medium_attribute.authors']}</f:facet>

					<bibi:columnContent>
						#{mediumSearch.formatAuthors(item)}
					</bibi:columnContent>
				</h:column>

				<h:column>
					<f:facet name="header">#{msg['medium_attribute.edition']}</f:facet>

					<bibi:columnContent>
						#{item.edition}
					</bibi:columnContent>
				</h:column>

				<h:column>
					<f:facet name="header">#{msg['medium_attribute.publisher']}</f:facet>

					<bibi:columnContent>
						#{item.publisher}
					</bibi:columnContent>
				</h:column>

			</bibi:paginatedList>

		</h:panelGrid>

	</ui:define>

</ui:composition>
