<?xml version="1.0" encoding="utf-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:bibi="http://xmlns.jcp.org/jsf/composite/bibi"
	template="/view/templates/template.xhtml">

	<ui:param name="page" value="category_browser" />

	<ui:define name="content">

		<h:panelGroup layout="block" styleClass="container">
			<h:panelGroup layout="block" styleClass="row">

				<!-- left column -->
				<h:panelGroup layout="block" styleClass="col-4">
					<h:form id="form_category_search" styleClass="mb-2">

						<h:panelGroup layout="block" styleClass="input-group">

							<h:inputText id="input_category_search_term"
								value="#{categoryBrowser.categorySearch.searchTerm}"
								styleClass="form-control" title="#{msg['search_term']}" />

							<h:commandButton id="button_search_category"
								value="#{msg['search']}"
								action="#{categoryBrowser.searchCategories()}"
								styleClass="btn btn-primary" />

						</h:panelGroup>

					</h:form>

					<h:panelGroup id="category_tree_1"
						binding="#{categoryBrowser.categoryTree}" />
				</h:panelGroup>

				<!-- right column -->
				<h:panelGroup layout="block" styleClass="col">

					<h:panelGrid layout="block" styleClass="container-fluid"
						rendered="#{categoryBrowser.currentCategory != null}">

						<h:form id="form_category_controls">

							<h:inputText id="input_category_name"
								value="#{categoryBrowser.currentCategory.name}"
								readonly="#{!categoryBrowser.writableCategoryName()}"
								styleClass="readonly-as-plain-text form-control">
								<f:validateLength minimum="1" maximum="100" />
							</h:inputText>

							<h:inputTextarea id="input_category_description"
								value="#{categoryBrowser.currentCategory.description}"
								readonly="#{!categoryBrowser.writableCategoryDescription()}"
								styleClass="readonly-as-plain-text form-control" />

							<h:commandButton id="button_save_category"
								value="#{msg['category_browser.category.save_changes']}"
								action="#{categoryBrowser.saveCategory()}"
								styleClass="btn btn-outline-secondary" />

							<h:commandButton id="button_delete_category"
								value="#{msg['category_browser.category.delete']}"
								action="#{categoryBrowser.deleteCategory()}"
								styleClass="btn btn-outline-danger" />

							<h:commandButton id="button_create_category"
								value="#{msg['category_browser.category.create_subcategory']}"
								action="#{categoryBrowser.createCategory()}"
								styleClass="btn btn-outline-primary" />

						</h:form>

						<bibi:paginatedList value="#{categoryBrowser}" styleClass="mt-5">

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.title']}</f:facet>

								<bibi:columnContent>
									<h:link value="#{item.title}"
										outcome="/view/public/medium.xhtml?id=#{item.id}" />
								</bibi:columnContent>
							</h:column>

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.authors']}</f:facet>

								<bibi:columnContent>
									<!-- put that method somewhere else! -->
						#{mediumSearch.formatAuthors(item)}
					</bibi:columnContent>
							</h:column>

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.edition']}</f:facet>

								<bibi:columnContent>
						#{item.edition}
					</bibi:columnContent>
							</h:column>

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.publisher']}</f:facet>

								<bibi:columnContent>
						#{item.publisher}
					</bibi:columnContent>
							</h:column>

						</bibi:paginatedList>

					</h:panelGrid>

				</h:panelGroup>

			</h:panelGroup>
		</h:panelGroup>

	</ui:define>

</ui:composition>
