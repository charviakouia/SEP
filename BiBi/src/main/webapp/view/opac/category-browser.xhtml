<?xml version="1.0" encoding="utf-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:bibi="http://xmlns.jcp.org/jsf/composite/bibi"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
	template="/view/templates/template.xhtml">

	<ui:param name="page" value="category_browser" />

	<ui:define name="content">

		<h:panelGroup layout="block" styleClass="container">
			<h:panelGroup layout="block" styleClass="row">

				<h:panelGroup layout="block" styleClass="col-4">
					<h:form id="form_category_search" styleClass="mb-2">
						<h:panelGroup layout="block" styleClass="input-group">
							<h:inputText id="input_category_search_term"
								value="#{categoryBrowser.categorySearch.searchTerm}"
								styleClass="form-control" title="#{msg['search_term']}" />
							<h:commandButton id="button_search_category"
								value="#{msg['search']}"
								action="#{categoryBrowser.searchCategories()}"
								styleClass="btn btn-primary" />
						</h:panelGroup>
					</h:form>

					<h:panelGroup id="category_tree_1"
						binding="#{categoryBrowser.categoryTree}" />
				</h:panelGroup>

				<h:panelGroup layout="block" styleClass="col">

					<h:panelGroup layout="block" styleClass="container-fluid"
						rendered="#{categoryBrowser.currentCategory != null}">

						<h:form id="form_category_controls">

							<h:inputText id="input_category_name"
								value="#{categoryBrowser.currentCategory.name}"
								readonly="#{!categoryBrowser.writableCategoryName()}"
								styleClass="readonly-as-plain-text form-control mb-3"
								p:placeholder="#{msg['category_browser.category.name']}">
								<f:validateLength minimum="1" maximum="100" />
							</h:inputText>

							<h:inputTextarea id="input_category_description"
								value="#{categoryBrowser.currentCategory.description}"
								readonly="#{!categoryBrowser.writableCategoryDescription()}"
								styleClass="readonly-as-plain-text form-control mb-3"
								p:placeholder="#{msg['category_browser.category.description']}" />

							<h:panelGroup layout="block" styleClass="btn-group"
								rendered="#{categoryBrowser.showingCategoryActions}">
								<h:commandButton id="button_save_category"
									value="#{msg['category_browser.category.save_changes']}"
									action="#{categoryBrowser.saveCategory()}"
									styleClass="btn btn-outline-secondary" />

								<h:link id="link_delete_category"
									value="#{msg['category_browser.category.delete']}"
									styleClass="btn btn-outline-danger" p:data-bs-toggle="modal"
									p:data-bs-target="#confirm_deletion_modal" />
								
								<h:panelGroup layout="block" p:id="confirm_deletion_modal"
									styleClass="modal fade" p:tabindex="-1">
									<h:panelGroup layout="block" styleClass="modal-dialog modal-dialog-centered">
										<h:panelGroup layout="block" styleClass="modal-content">
											<h:panelGroup layout="block" styleClass="modal-header">
												<h:outputText styleClass="h5 modal-title" value="#{msg['category_browser.confirm_deletion.title']}" />
											</h:panelGroup>
											<h:panelGroup layout="block" styleClass="modal-body">
												#{msg['category_browser.confirm_deletion.message']}
											</h:panelGroup>
											<h:panelGroup layout="block" styleClass="modal-footer">
												<h:commandButton id="button_disallow_category_deletion"
													styleClass="btn btn-secondary" value="#{msg['category_browser.confirm_deletion.cancel']}"
													p:data-bs-dismiss="modal" />
												<h:commandButton id="button_confirm_category_deletion"
													styleClass="btn btn-danger" value="#{msg['category_browser.confirm_deletion.confirm']}"
													action="#{categoryBrowser.deleteCategory()}" />
											</h:panelGroup>
										</h:panelGroup>
									</h:panelGroup>
								</h:panelGroup>

								<h:commandButton id="button_create_category"
									value="#{msg['category_browser.category.create_subcategory']}"
									action="#{categoryBrowser.createCategory()}"
									styleClass="btn btn-outline-primary" />
							</h:panelGroup>
						</h:form>

						<bibi:paginatedList value="#{categoryBrowser}" styleClass="mt-5">

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.title']}</f:facet>

								<bibi:columnContent>
									<h:link value="#{item.title}"
										outcome="/view/opac/medium.xhtml?id=#{item.id}" />
								</bibi:columnContent>
							</h:column>

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.authors']}</f:facet>

								<bibi:columnContent>
									put that method somewhere else!
									#{mediumSearch.formatAuthors(item)}
								</bibi:columnContent>
							</h:column>

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.edition']}</f:facet>

								<bibi:columnContent>
									#{item.edition}
								</bibi:columnContent>
							</h:column>

							<h:column>
								<f:facet name="header">#{msg['medium_attribute.publisher']}</f:facet>

								<bibi:columnContent>
									#{item.publisher}
								</bibi:columnContent>
							</h:column>

						</bibi:paginatedList>

					</h:panelGroup>

				</h:panelGroup>
			</h:panelGroup>
		</h:panelGroup>

	</ui:define>

</ui:composition>
