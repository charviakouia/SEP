
\documentclass{article}

\usepackage[ngerman]{babel}
\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{changepage}
\usepackage{booktabs}
\usepackage{float}
\usepackage{tabulary}
\usepackage{xcolor}
\usepackage{multirow}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{lscape}
\usepackage{listings}

\graphicspath{ {./images/} }
\setlength\parindent{0pt}

\hypersetup{
    colorlinks,
    linkcolor={cyan!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}

\makeatletter
\newcommand{\sectionauthor}[1]{
	{\parindent 0em \large \scshape Autor: #1 \par \nobreak \vspace*{1em}}
	\@afterheading
}
\newcommand{\specification}[3]{
	{\parindent 0.5em \hangindent 3em \hypertarget{spec:#1:#2}{\textbf{/#1#2/}} #3 \par \nobreak \vspace*{0.5em}}
}
\makeatother

\title{Bibliotheksanwendung - Feinspezifikation}
\date{\today\\v1.0}
\author{
	Ivan Charviakou\\
	León Liehr\\
	Mohamad Najjar\\
	Jonas Picker\\
	Sergei Pravdin
}

\begin{document}
\maketitle
\begin{figure}[H]
	\centering
	\includegraphics[width = 30em]{Logo}
\end{figure}
\newpage
\tableofcontents
\newpage

%----------------------------------------------------------------------Kapitel 1--------------------------------------------------------------------------------------------

\section{Einleitung}
Bei diesem Dokument handelt es sich um die Feinspezifikation unseres Bibliothekssystems. Es baut direkt auf dem vorangegangenen Entwurf auf und enthält einen noch genaueren Umriss der zu erstellenden Applikation.

%----------------------------------------------------------------------Kapitel 2--------------------------------------------------------------------------------------------

\section{Projektübersicht}
\sectionauthor{Ivan Charviakou}

\subsection{Paketübersicht und Ordnerstruktur}
Das angegebene Diagramm stellt die MVC-Architektur mit den Beziehungen zwischen den einzelnen Komponenten anhand der gegebenen Applikation dar.
Dabei folgt die Komponentenaufteilung der Paketstruktur der Applikation und es werden die Paketnamen zusammen mit den wichtigsten darin enthaltenen Klassen / Komponenten / Funktionalitäten angegeben.
Zudem entsprechen die Farben, die die Pakete im Diagramm besitzen, den Farben im nachfolgenden Klassendiagramm. \vspace{0.5em}

Die Ordnerstruktur des Projekts wird als Ordnerbaum dargestellt.
Während die Paketstruktur im Ordner 'BiBi.src.main.java' abgebildet ist, enthält 'BiBi.src.main.webapp.view' die verwendeten Facelets mit entsprechender Rollenzuordnung. \vspace{0.5em}

\begin{figure}[H]
\centering
\includegraphics[width = 40em]{Modeldiagramm}
\caption{Modeldiagramm}
\end{figure}	
	
\begin{figure}[H]	
\centering
\includegraphics[width = 20em]{FileStructure}
\caption{Ordnerstruktur}
\end{figure}

%----------------------------------------------------------------------Kapitel 3--------------------------------------------------------------------------------------------
\section{UML-Klassendiagramme}
\sectionauthor{Mohamad Najjar}


Das Paketdiagramm veranschaulicht  die Rollen und Beziehungen der Pakete im Sichtmodell. Die Farben der Klassendiagramme entsprechen ihren jeweiligen Paketen im \hyperlink{Pakete}{Paketdiagramm}. Die Kommentare finden sich im Anhang.

\newgeometry{left=0cm,right=0cm,top=0cm,bottom=0cm}
\begin{figure}[H]
\hypertarget{Pakete}
		\centering
		\includegraphics[width = 52em]{Paketdiagramm}
		\caption{Paketdiagramm}
	\end{figure}

\begin{figure}[H]
\hypertarget{DAOs}{}
		\centering
		\includegraphics[width = 45em]{KlassendiagrammDaos}
		\caption{Klassendiagramm der Daos}
	\end{figure}

\begin{figure}[H]
\hypertarget{Usersession}{}
		\centering
		\includegraphics[angle=270, width=24em]{Klassendiagramm-Backingbeans}
		\caption{Klassendiagramm-Backingbeans}
	\end{figure}




\begin{figure}[H]
		\centering
		\includegraphics[width = 52em]{Klassendiagramm-Convertors}
		\caption{Klassendiagramm der Konverter}
	\end{figure}

\begin{figure}[H]
\hypertarget{Validator}{}
		\centering
		\includegraphics[width = 52em]{KlassendiagrammValidators}
		\caption{Klassendiagramm der Validatoren}
	\end{figure}


\begin{figure}[H]
		\centering
		\includegraphics[angle=270, width = 52em]{Klassendiagramm-Dtoss_1}
		\caption{Klassendiagramm der Dtos}
	\end{figure}

\begin{figure}[H]
		\centering
		\includegraphics[width = 52em]{Klassendiagramm-ExceptionsObere}
		\caption{Klassendiagramm der logic.exceptions}
	\end{figure}

\begin{figure}[H]
\hypertarget{PhaseListener}{}
\hypertarget{Hash}{}
		\centering
		\includegraphics[width = 52em]{KlassendiagrammUtilObere}
		\caption{Klassendiagramm der logic.util}
	\end{figure}


\begin{figure}[H]
		\centering
		\includegraphics[width = 52em]{KlassendiagrammUtilunten}
		\caption{Klassendiagramm der persistence.util}
	\end{figure}


\begin{figure}[H]
		\centering
		\includegraphics[width = 52em]{Klassendiagramm-ExceptionUnten}
		\caption{Klassendiagramm der persistence.exceptions}
\end{figure}
\restoregeometry
%----------------------------------------------------------------------Kapitel 4--------------------------------------------------------------------------------------------
\newpage
\section{Bibliotheken}
\sectionauthor{Sergei Pravdin}

\newenvironment{controls}
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ p{7em} p{19em} p{4em} p{12em} }
            \toprule
            \textbf{Bibliothek} & \textbf{Anwendungsbereich} & \textbf{Version} & \textbf{Lizenz}\\
            \midrule
        }
        {
            \bottomrule
        \end{tabular}
    \end{table}
}

Folgende Bibliotheken bzw. Frameworks werden für die Entwicklung unseres Bibliothekssystems verwendet.

\begin{controls}
    Jakarta Server Faces (JSF) & Grafische Benutzeroberflächen des Bibliothekssystems & 3.0.0 & GNU GPL / Java Community Process\\
    JDBC-Treiber für PostgreSQL & Integration des Bibliothekssystems mit der Datenbank & 42.2.20 & GNU GPL / Java Community Process\\
    Apache Tomcat & Webserver & 10.0.2 & Apache-Lizenz 2.0\\
    Weld & Dependency Injection mittels Annotationen & 4.0.1 & Apache-Lizenz 2.0\\
    Jakarta Mail & Senden und Empfangen von E-Mails für die Verifizierung der Nutzers & 1.6.5 & CDDL 1.0, GPL 2.0, BSD\\
    Bootstrap & Anordnung der Frontend-CSS-Komponenten & 5.0.0 & MIT-Lizenz\\
\end{controls}

%----------------------------------------------------------------------Kapitel 5--------------------------------------------------------------------------------------------
\section{Systemkonfiguration}
\sectionauthor{Jonas Picker}
Dieser Abschnitt beschreibt die Konfigurationsdatei und Sprachausgabe der Anwendung.
\subsection{Konfigurationsdatei}
\indent Die Anwendung wird in einer Datei namens 'config.properties' im \hyperlink{https://de.wikipedia.org/wiki/Java-Properties-Datei}{{\texttt.properties}-Format} konfiguriert. Diese Datei wird dann mit Java-internen Funktionalitäten \hyperlink{https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html}{dieser Klasse} über einen Stream im \hyperlink{ConfigReader}{ConfigReader} eingelesen. Sie ist im Verzeichnis der Anwendung unter \hyperlink{Paketstruktur}{\texttt{/WebContent/WEB-INF/}} zu finden.
\subsubsection{Inhaltsbeschreibung}
\hypertarget{propSchema}{}
Es folgt eine \hyperlink{tabelle}{Tabelle} mit einer deutschen Beschreibung der im Anhang beigefügten \texttt{config.properties}-Datei. Die mit \textcolor{green}{!} oder \textcolor{green}{\#} eingeleiteten Zeilen der Dateien enthalten Kommentare. Alle unmarkierten Zeilen halten ein Paar aus einem Schlüssel und einem mit \texttt{:} getrennten Wert. Nur die Werte dürfen verändert werden! \\
\textbf{Logs:} Die Klasse \hyperlink{Logger}{Logger}!!! schreibt ihre Einträge im \hyperlink{https://de.wikipedia.org/wiki/Java-Properties-Datei}{\texttt{.properties}-Format} in eine Datei unter \hyperlink{Paketstruktur}{\texttt{!!!}}!!!, wie der \hyperlink{ConfigReader}{ConfigReader} benutzt auch der \hyperlink{Logger}{Logger}!! die Methoden der Java-Klasse \hyperlink{https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html}{Properties}.\\
\textbf{Datenbankverbindung:} Durch setzen der \hyperlink{DBSSL}{entsprechenden Variablen} unterstützt unser System sowohl die Anbindung der Datenbank über JDBC, als auch über JDBCS. So können auch lokale Speicher am selben Server oder im Netzwerk ohne eigenes SSL-Zertifikat verwendet werden. \\
- config.properties in den Anhang\\
- Ordnerstruktur konsistenzcheck!\\
- Links eintragen!!!\\

\begin{center}
\begin{table}[H]
\hypertarget{tabelle}{}
\begin{tabular} {| m{4cm} | m{6cm} | m{5cm} |}
\hline
Schlüsselname & Wertebeschreibung & Wertebereich \\
\hline
DB\_HOST & Die URL (bzw. URI) unter der der Datenbankserver erreichbar ist.& Ein \hyperlink{https://datatracker.ietf.org/doc/html/rfc3986}{'Uniform Ressource Identifier'}. Der Standartwert ist 'localhost'.\\
\hline
DB\_PORT & Der Port unter dem der Server Anfragen entgegennimmt. & Eine ganze Zahl von 0 bis 65535. Der Standartport für Postgreserver ist 5432.\\
\hline
DB\_NAME & Der Name der Datenbank auf dem Server. & Ein String. Wenn kein Name spezifiziert wird, ist der eingetragene Benutzername Standartwert.\\
\hline
DB\_USER & Der Name eines in der Datenbank registrierten Benutzers. & Ein String. Pflichtfeld!\\
\hline
DB\_PASSWORD & Das Passwort des oben angegebenen Datenbankbenutzers. & Ein String. Pflichtfeld!\\
\hline
DB\_TLS &  \hypertarget{DBSSL}{Diese Option} legt das zur Kommunikation mit der Datenbank verwendete Protokoll fest (der Server muss dies unterstützen!). & Ein Boolean. 'TRUE' für das SSL-verschlüsselte Verbindung, 'FALSE' ohne SSL-Verschlüsselung. Die verwendete SSL-Factory ist \hyperlink{https://jdbc.postgresql.org/documentation/publicapi/org/postgresql/ssl/DefaultJavaSSLFactory.html}{hier} zu finden.\\ 
\hline
DB\_CAPACITY & Die maximale Anzahl an Verbindungen, die die Datenbank dem Server zu Verfügung stellen kann. & Eine natürliche Zahl (nicht 0). Standartwert ist 5.\\
\hline
MAILSERVER\_HOST & Der URI unter der der E-Mail-Server erreichbar ist. &  Ein \hyperlink{https://datatracker.ietf.org/doc/html/rfc3986}{'Uniform Ressource Identifier'}. Pflichtfeld! \\ 
\hline
MAILSERVER\_PORT & Der Port durch den Anfragen an den Server geleitet werden. & Eine ganze Zahl von 0 bis 65535. Pflichtfeld! Standartwert ist 25. \\
\hline
MAIL\_SOURCE & Die Absenderadresse für E-Mails des Bibliothekssystems. & Gültige E-Mail-Adressen folgen \hyperlink{https://datatracker.ietf.org/doc/html/rfc5322}{diesem Schema}. Pflichtfeld!\\
\hline
MAIL\_TLS & Diese Option legt das zur Kommunikation mit dem Mail-Server verwendete Protokoll fest (der Server muss dies unterstützen!). & Ein Boolean. 'TRUE' für das SMTPS Protokoll, 'FALSE' für SMTP ohne SSL-Verschlüsselung.\\ 
\hline
MAIL\_USER & Der Benutzername des Accounts am Mail-Server & Ein String. Pflichtfeld, wenn die MAIL\_TLS Option auf TRUE gesetzt wurde!\\
\hline
MAIL \_PASSWORD & Das Passwort zu obigem Benutzeraccount & Ein String. Pflichtfeld, wenn die MAIL\_TLS Option auf TRUE gesetzt wurde!\\
\hline
SCAN\_INTERVAL & Der Wartungsthread des Systems führt in diesem Interval automatische Aufgaben durch. & Eine natürliche Zahl (nicht 0) die Minuten repräsentiert. Standartwert ist 20. \\
\hline
DEFAULT\_ADMIN\_MAIL & Diese Zeichenkette wird ohne Verifizierung als E-Mail des ersten Administratoraccounts (PW: 'bibadmin') eingetragen, falls es noch keinen gibt (Daten im laufenden System änderbar).  & Gültige E-Mail-Adressen folgen \hyperlink{https://datatracker.ietf.org/doc/html/rfc5322}{diesem Schema}, andernfalls kommen versendete Mails nicht an. Schlüssel ist auch Standartwert.\\
\hline
LOG\_LEVEL & Eine Granularitätsoption für die Protokollierung der Fehler und Systemabläufe. & Im Detailgrad aufsteigend: 'SEVERE', 'DETAILED', 'DEVELOPMENT'. Standart ist 'SEVERE', andere Werte werden ignoriert. \\
\hline
LOG\_CONSOLE & Gibt an, ob die Systemprotokolle auch auf der Konsole ausgegeben oder nur ins Log geschrieben werden. & Ein Boolean aus 'TRUE' oder 'FALSE'. Andere Werte werden ignoriert. Standartwert ist 'FALSE'. \\
\hline
\end{tabular}
\end{table}
\end{center}

\subsection{Sprachressourcen}
\indent Obwohl die Anwendung primär in Deutsch ausgeliefert wird, bietet die modulare Bauweise eine Erweiterungsmöglichkeit um andere Sprachausgaben. Dazu werden alle angezeigten Strings einer Sprache zentral im Ordner hyperlink{Paketstruktur}{\texttt{src/de/dedede/model/logic/}} des Applikationsverzeichnisses im \hyperlink{https://de.wikipedia.org/wiki/Java-Properties-Datei}{\texttt{.properties}-Format} gespeichert. Die Namenskonvention für diese Dateien ist \texttt{messages\_xxXX.properties}, wobei \texttt{xx} durch das jeweilige \hyperlink{https://de.wikipedia.org/wiki/Liste_der_ISO-639-1-Codes}{Sprachenkürzel} ersetzt wird, welches durch \texttt{XX} ebenfalls im Dialekt spezifiziert werden kann. Sprachübergreifende Begriffe werden in die \hyperlink{messages}{\texttt{messages.properties}}-Datei geschrieben, und sprachspezifische Übersetzungen werden wie oben beschrieben  Die Pakete sind durch Eintrag in die \texttt{faces-config.xml} im JSF-Framework registriert. Damit sind die Schlüssel mittels EL in den Facelets referenzierbar und die Nachrichten werden dann automatisch mit dem ausgewählten \texttt{locale} befüllt.  So kann die Sprache, entweder auf der Profilseite manuell oder auch automatisch durch die Browserpräferenz, pro Nutzer-Session dynamisch eingestellt werden. Standartsprache ist Deutsch. Die Sprachdateien selbst folgen obigen \hyperlink{propSchema}{Schema}, mit Präfixen an den Schlüsseln um die Zugehörigkeit zum jeweiligen Facelet anzuzeigen ('lp' = 'login page', 'sb' = 'sidebar' etc.). Die Schlüssel können einfach kopiert, mit Werten ergänzt und in den \hyperlink{Paketstruktur}{\texttt{entsprechenden}}!!!-Ordner gelegt werden. Ein Beispiel für die \hyperlink{messages}{sprachübergreifende} \hyperlink{messagesde}{deutsche} und \hyperlink{messagesen}{englische} Datei ist anbei.\\
\begin{figure}[H]
\hypertarget{messages}{}
\centering
\includegraphics[width=50em]{messagesen}
\caption{Sprachübergreifende Begriffe}
\end{figure}

\begin{figure}[H]
\hypertarget{messagesen}{}
\centering
\includegraphics[width=50em]{messagesen}
\caption{Englisches Sprachpaket}
\end{figure}

\begin{figure}[H]
\hypertarget{messagesde}{}
\centering
\includegraphics[width=50em]{messagesde}
\caption{Deutsches Sprachpaket}
\end{figure}


%----------------------------------------------------------------------Kapitel 6--------------------------------------------------------------------------------------------

\section{View}
\sectionauthor{León Liehr}

Was noch fehlt:

\begin{itemize}
    \item IDs pro Element
    \item Korrekte Sichtbarkeiten (es fehlt konditionales read-only zB)
    \item Composite-Component-Definitionen für paginierte Liste etc.
    \item Manchmal fehlt repeat-Element
    \item Manche Tabellen sind noch nicht im neuen Format (die, die „Beschreibung“ haben)
    \item Converter und Validators sind nicht aufgezeichnnet
\end{itemize}

\newcommand{\M}[1]{\texttt{#1}} % monospaced
\newcommand{\tag}[2]{\M{#1:#2}} % JSF tag
\newcommand{\B}[1]{\#\{#1\}} % JSF binding
\newcommand{\MB}[1]{\M{\B{#1}}} % monospaced JSF binding

% @Beacon @Temporary
\renewenvironment{controls}
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ p{7em} p{25em} p{7em} }
            \toprule
            \textbf{Typ} & \textbf{Beschreibung} & \textbf{Sichtbarkeit}\\
            \midrule
        }
        {
            \bottomrule
        \end{tabular}
    \end{table}
}

\long\def\begincontrols [#1] #2\endcontrols
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ l l l l }
            \toprule
            & \multicolumn{2}{l}{\textbf{Attribut}} &\\
            \cmidrule(r){2-3}
            \textbf{Typ} & \textbf{Name} & \textbf{Wert} & \textbf{Sichtbarkeit}\\
            \midrule
            #2
            \bottomrule
        \end{tabular}
        \caption{\M{#1.xhtml}}
    \end{table}
}

\long\def\beginsubcontrols [#1][#2] #3\endsubcontrols
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ l l l l }
            \toprule
            & \multicolumn{2}{l}{\textbf{Attribut}} &\\
            \cmidrule(r){2-3}
            \textbf{Typ} & \textbf{Name} & \textbf{Wert} & \textbf{Sichtbarkeit}\\
            \midrule
            #3
            \bottomrule
        \end{tabular}
        \caption{#1}
        \label{#2}
    \end{table}
}

\newcommand{\PUB}{jeder}
\newcommand{\ANO}{Anon.}
\newcommand{\USR}{Nutzer}
\newcommand{\BIB}{Mitarbeiter}
\newcommand{\ADM}{Admin.}

\newcommand{\component}[2]{\subsubsection{#1 (\texttt{#2})}}

\newcommand{\BTN}{\tag{h}{commandButton}}
\newcommand{\LNK}{\tag{h}{outputLink}}
\newcommand{\INP}{\tag{h}{inputText}}
\newcommand{\PAS}{\tag{h}{inputSecret}}
\newcommand{\DRP}{\tag{h}{selectOneMenu}}
\newcommand{\CHK}{\tag{h}{selectBooleanCheckbox}}
\newcommand{\OUT}{\tag{h}{outputText}}
\newcommand{\LST}{\tag{bibi}{paginatedList}}

\begin{landscape}

\subsection{Komponenten}

JSF Composite Components.

\subsection{Seitenvorlage}\label{page_template}

JSF Templates.

\begincontrols[template]
    \tag{ui}{insert} & \M{name} & \M{title} & \\
    \tag{ui}{insert} & \M{name} & \M{content} & \\
    \tag{ui}{include} & \M{src} & \hyperref[page_header]{\M{header.xhtml}} & \\
    \tag{h}{messages} & \M{globalOnly} & \M{true} & \\
    \tag{ui}{include} & \M{src} & \hyperref[page_footer]{\M{footer.xhtml}} & \\
\endcontrols

\subsubsection{Kopfzeile}\label{page_header}

\begincontrols[header]
    \multirow{2}{*}{\tag{h}{commandButton}} & \M{id} & \M{xxx} & \\
    & \M{action} & \MB{header.displayHelpText()} & \\
    \INP & \M{value} & \MB{header.mediumSearchTerm} & \\
    \LNK & \M{value} & \hyperref[page_medium_search]{\M{public/medium-search.xhtml}} & \\
    \tag{h}{graphicImage} & \M{value} & \MB{header.application.logo} & \\
    \OUT & \M{value} & \MB{header.application.name} & \\
    \tag{h}{commandLink} & \M{action} & \MB{header.logOut()} & \\
    \LNK & \M{value} & \hyperref[page_login]{\M{public/login.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_registration]{\M{public/registration.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_profile]{\M{profile.xhtml?id=\B{header.user.id}}} & \\
\endcontrols

\subsubsection{Fußzeile}\label{page_footer}

\begincontrols[footer]
    \LNK & \M{value} & \hyperref[page_privacy_policy]{\M{public/privacy-policy.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_site_notice]{\M{public/site-notice.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_contact]{\M{public/contact.xhtml}} & \\
\endcontrols

\subsection{Seiten}

\subsubsection{Abzuholende Exemplare}\label{page_copies_ready_for_pickup}

\begin{controls}
    \LST & aller abzuholenden Exemplare & \BIB\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{19em} p{7em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung} & \textbf{Sichtbarkeit}\\
        \midrule
        Exemplar & \LNK & die Signatur eines Exemplars; zur Direktausleihe & \BIB\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht & \BIB\\
        Nutzer & \OUT & E-Mail-Adresse & Nicht-\ADM\\
        Nutzer & \LNK & E-Mail-Adresse; zum Profil & \ADM\\
        Zeit & \OUT & Dauer bis zum Zeitpunkt der Fristüberschreitung & \BIB\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar und Nutzer}
\end{table}

\subsubsection{Eigene abzuholende Exemplare}\label{page_my_copies_ready_for_pickup}

\begin{controls}
    \LST & aller abzuholenden Exemplare & \USR\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{27em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung}\\
        \midrule
        Exemplar & \OUT & die Signatur eines Exemplars\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht\\
        Zeit & \OUT & Dauer bis zum Überschreiten der Abholungsfrist\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar}
\end{table}

\subsubsection{Eigene ausgeliehene Exemplare}\label{page_my_borrowed_copies}

\begin{controls}
    \LST & aller ausgeliehenen Exemplare & \USR\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{27em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung}\\
        \midrule
        Exemplar & \OUT & die Signatur eines Exemplars\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht\\
        Zeit & \OUT & Dauer bis zum Überschreiten der Rückgabefrist\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar}
\end{table}

\subsubsection{Anmeldemaske}\label{page_login}

\begincontrols[public/login]
    \INP & \M{value} & \MB{login.user.email} & \ANO\\
    \PAS & \M{value} & \MB{login.user.password} & \ANO\\
    \BTN & \M{action} & \MB{login.logIn()} & \ANO\\
    \tag{h}{commandLink} & \M{action} & \MB{login.resetPassword()} & \ANO\\
\endcontrols

\subsubsection{Datenschutzerklärung}\label{page_privacy_policy}

\begincontrols[public/privacy-policy]
    % TASK do the readonly stuff!!
    \INP & \M{value} & \MB{privacyPolicy.application.privacyPolicy} & \ADM\\
    \BTN & \M{action} & \MB{privacyPolicy.save()} & \ADM\\
\endcontrols

\subsubsection{Direktausleihe}\label{page_direct_lending}

\begincontrols[staff/reactive-lending]
    \tag{bibi}{reactiveInputText} & \M{value} & \MB{directLending.user.email} & \BIB\\
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{directLending.copies} & \multirow{2}{*}{\BIB}\\
    & \M{var} & \hyperref[subcontrol_direct_lending_copy]{\M{copy}} & \\
    \BTN & \M{action} & \MB{directLending.addSignatureInputField()} & \BIB\\
    \BTN & \M{action} & \MB{directLending.lendCopies()} & \BIB\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Exemplar (5 bei Seitenaufruf)][subcontrol_direct_lending_copy]
\tag{bibi}{reactiveInputText} & \M{value} & \MB{copy.signature} & \BIB\\
\endsubcontrols

\subsubsection{E-Mail-Bestätigung}\label{page_email_confirmation}

\begincontrols[public/email-confirmation]
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{token} & \multirow{2}{*}{\PUB}\\
    & \M{value} & \MB{emailConfirmation.token} &\\
\endcontrols

\subsubsection{Fehlerseite}\label{page_error}

\begin{controls}
    \OUT & für den Titel der Fehlermeldung & \PUB\\
    \OUT & für die Beschreibung des Fehlers & \PUB\\
\end{controls}

\subsubsection{Impressum}\label{page_site_notice}

\begincontrols[public/site-notice]
    % TASK readonly for users and staff
    \INP & \M{value} & \MB{siteNotice.application.siteNotice} & \ADM\\
    \BTN & \M{action} & \MB{siteNotice.save()} & \ADM\\
\endcontrols

\subsubsection{Kategorienbearbeitung}\label{page_category_editor}

\begincontrols[staff/category-editor]
    \INP & \M{value} & \MB{categoryEditor.category.name} & \BIB\\
    \INP & \M{value} & \MB{categoryEditor.category.description} & \BIB\\
    \BTN & \M{action} & \MB{categoryEditor.save()} & \BIB\\
\endcontrols

\subsubsection{Kategorierenstöberer}\label{page_category_browser}

\begincontrols[public/category-browser]
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{categoryBrowser.searchTerm} & \PUB\\
    \BTN & \M{action} & \MB{categoryBroswer.searchCategory()} & \PUB\\
    \tag{bibi}{treeView} & & & \PUB \\
    \OUT & \M{value} & \MB{categoryBrowser.category.name} & \PUB\\
    \OUT & \M{value} & \MB{categoryBrowser.category.description} & \PUB\\
    \tag{h}{commandLink} & \M{action} & \hyperref[page_category_editor]{\M{staff/category-editor.xhtml}} & \BIB\\ % edit
    \tag{h}{commandLink} & \M{action} & \hyperref[page_category_editor]{\M{staff/category-editor.xhtml}} & \BIB\\ % create
    \BTN & \M{action} & \MB{categoryBroswer.delete()} & \BIB\\
    \LST & & aller Medien (Medienvorschauen) in der ausgewählten Kategorie & \PUB\\
\endcontrols

\subsubsection{Kontakt}\label{page_contact}

\begincontrols[public/contact]
    % TASK readonly for users and staff
    \INP & \M{value} & \MB{contact.application.contactInfo} & \ADM\\
    \BTN & \M{action} & \MB{contact.save()} & \ADM\\
\endcontrols

\subsubsection{Leihfristverstöße}\label{page_lending_period_violations}

\begin{controls}
    \LST & von Exemplaren und Nutzern & \ADM\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{27em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung}\\
        \midrule
        Exemplar & \LNK & die Signatur eines Exemplars; zur Medienrückgabe\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht\\
        Nutzer & \LNK & E-Mail-Adresse; zum Profil\\
        Überschreitung & \OUT & Dauer seit dem Zeitpunkt der Fristüberschreitung\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar und Nutzer}
\end{table}

\subsubsection{Medienerstellung}\label{page_medium_creation}

\begincontrols[staff/medium-creation]
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{mediumCreation.medium.attributes} & \multirow{2}{*}{\BIB}\\
    & \M{var} & \hyperref[subcontrol_medium_creation_attribute]{\M{attribute}} &\\
    \INP & \M{value} & \MB{mediumCreation.medium.category} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.medium.returnPeriod} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.copy.location} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.copy.signature} & \BIB\\
    \BTN & \M{action} & \MB{mediumCreation.create()} & \BIB\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Attribut][subcontrol_medium_creation_attribute]
% QUESTION what other attributes (lavel attribut.type??)
\INP & \M{value} & \MB{attribute.value} & \BIB\\
\endsubcontrols

\subsubsection{Medienrückgabe}\label{page_return_form}

\begincontrols[staff/return-form]
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{returnForm.user.email} & \BIB\\
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{returnForm.copies} & \multirow{2}{*}{\BIB}\\
    & \M{var} & \hyperref[subcontrol_return_form_copy]{\M{copy}} & \\
    \BTN & \M{action} & \MB{returnForm.addSignatureInputField()} & \BIB\\
    \BTN & \M{action} & \MB{returnForm.returnMedium()} & \BIB\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Exemplare (5 bei Seitenaufruf)][subcontrol_return_form_copy]
\tag{bibi}{reactiveInputField} & \M{value} & \MB{copy.signature} & \BIB\\
\endsubcontrols

\subsubsection{Mediensuche}\label{page_medium_search}

\begincontrols[public/medium-search]
    \INP & \M{value} & \MB{mediumSearch.generalSearchTerm} & \PUB\\
    \BTN & \M{action} & \MB{mediumSearch.search()} & \PUB\\
    \tag{ui}{repeat} & \M{value} & \MB{mediumSearch.searchQueries} & \PUB\\
    \BTN & \M{action} & \MB{mediumSearch.addNuancedSearchQuery())} & \PUB\\
    % BEACON TEMPORARY
    \LST & & aller Suchergebnisse (als Medienvorschauen) & \PUB\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Suchabfrage (3 bei Seitenaufruf)][subcontrol_medium_search_query]
% TASK converter
\DRP & \M{value} & \MB{query.operator} & \PUB\\
% TASK three times, converter, grouped
\DRP & \M{value} & \MB{query.criterion} & \PUB\\
% TASK three times, grouped
\INP & \M{value} & \MB{query.term} & \PUB\\
\endsubcontrols

\subsubsection{Mediumsansicht}\label{page_medium}

\begincontrols[public/medium]
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{id} & \multirow{2}{*}{\PUB}\\
    & \M{value} & \MB{medium.medium.id} & \\
    % TODO nur sichtbar wenn man von der Suche kommt
    \LNK & \M{value} & \hyperref[page_medium_search]{\M{public/medium-search.xhtml}} & \PUB\\
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{medium.medium.attributes} & \multirow{2}{*}{\PUB}\\
    & \M{var} & \hyperref[subcontrol_medium_attribute]{\M{attribute}} & \\
    \BTN & \M{action} & \MB{medium.saveAttributes()} & \BIB\\
    \BTN & \M{action} & \MB{medium.pickUpAnyCopy()} & \USR\\
    \OUT & \M{value} & \MB{medium.returnPeriod} & \USR\\
    \INP & \M{value} & \MB{medium.medium.returnPeriod} & \BIB\\
    \BTN & \M{action} & \MB{medium.saveReturnPeriod()} & \BIB\\
    \BTN & \M{action} & \MB{medium.delete()} & \BIB\\
    \multirow{3}{*}{\tag{h}{dataTable}} & \M{value} & \MB{medium.copies} & \multirow{3}{*}{\PUB}\\
    & \M{var} & \hyperref[data_table_medium_copies]{\M{copy}} & \\
    & \M{varStatus} & \M{status} & \\
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{medium.copy.location} & \BIB\\
    \INP & \M{value} & \MB{medium.copy.signature} & \BIB\\
    \BTN & \M{action} & \MB{medium.createCopy()} & \BIB\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Attribut][subcontrol_medium_attribute]
%    \OUT & für ein Medienattribut; existiert pro Medienattribut; mehrwertige Attribute durch Komma getrennt angezeigt & \ANO, \USR\\
% TASK visibility
% TASK multivalued
\INP & \M{value} & \MB{attribute.value} & \BIB\\
% TODO existiert pro Mediena
%    \BTN & \M{action} & \MB{medium.addAttributeInputField()} zum Hinzufügen eines weiteren Attributeingabefelds; existiert pro Medienattribut & \BIB\\
\endsubcontrols

\begin{table}[H]
    \centering
    \begin{tabular}{ l l l l l }
        \toprule
        & & \multicolumn{2}{l}{\textbf{Attribut}} &\\
        \cmidrule(r){3-4}
        \textbf{\tag{h}{column}} & \textbf{Typ} & \textbf{Name} & \textbf{Wert} & \textbf{Sichtbarkeit}\\
        \midrule

%        Standort & \OUT & & \PUB\\
        Standort & \INP & \M{value} & \MB{copy.location} & \BIB\\
        Verfügbarkeit & \OUT & \M{value} & \MB{copy.availabilityStatus} & \PUB\\
%        Signatur & \OUT & & \PUB\\
        Signatur & \INP & \M{value} & \MB{copy.signature} & \BIB\\
        Aktionen & \BTN & \M{action} & \MB{medium.saveCopy(status.index)} & \BIB\\
        Aktionen & \BTN & \M{action} & \MB{medium.deleteCopy(status.index)} & \BIB\\
        Aktionen & \BTN & \M{action} & \MB{medium.cancelPickup(status.index)} & \BIB\\
        % nur sichtbar falls verfügbar TODO
        Aktionen & \tag{h}{commandLink} & \M{action} & \MB{medium.lendCopy(status.index)} & \BIB\\
        % nur falls ausgeliehen TODO
        Aktionen & \tag{h}{commandLink} & \M{action} & \MB{medium.returnCopy(status.index)} & \BIB\\
        % nur wenn nutzer darf TODO
        Aktionen & \BTN & \M{action} & \MB{medium.pickUpCopy(status.index)} & \USR\\
        \bottomrule
    \end{tabular}
    \caption{Bedienelemente pro Exemplar}
    \label{data_table_medium_copies}
\end{table}

\subsubsection{Mediumschemabearbeitung}\label{page_medium_schema_editor}

\begincontrols[admin/medium-schema-editor]
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{mediumSchemaEditor.attributes} & \multirow{2}{*}{\ADM}\\
    & \M{var} & \hyperref[subcontrol_schema_editor_attribute]{\M{attribute}} & \\
    \BTN & \M{action} & \MB{mediumSchemaEditor.addAttributeInputField()} & \ADM\\
    \BTN & \M{action} & \MB{mediumSchemaEditor.save()} & \ADM\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Attribut][subcontrol_schema_editor_attribute]
\INP & \M{value} & \MB{attribute.name} & \ADM\\
\DRP & \M{value} & \MB{attribute.type} & \ADM\\
\DRP & \M{value} & \MB{attribute.multiplicity} & \ADM\\
\DRP & \M{value} & \MB{attribute.position} & \ADM\\
\BTN & \M{action} & \MB{mediumSchemaEditor.deleteAttribute(attribute.id)} & \ADM\\
\endsubcontrols

\subsubsection{Nutzersuche}\label{page_user_search}

\begincontrols[admin/user-search]
    \INP & \M{value} & \MB{userSearch.searchTerm} & \ADM\\
    \BTN & \M{action} & \MB{userSearch.searchUser()} & \ADM\\
    \CHK & \M{value} & \MB{userSearch.accountStatus} & \ADM\\
    %TODO beacon
    \LST & & & \ADM\\
    \LST & aller Suchergebnisse (als Medienvorschauen); je ein \LNK zur Medienansicht & \ADM\\
\endcontrols

\subsubsection{Passwortzurücksetzung}\label{page_password_reset}

\begincontrols[public/password-reset]
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{token} & \multirow{2}{*}{\PUB}\\
    & \M{value} & \MB{passwordReset.token} & \\
    \PAS & \M{value} & \MB{passwordReset.password} & \PUB\\
    \PAS & \M{value} & \MB{passwordReset.confirmedPassword} & \PUB\\
    \BTN & \M{action} & \MB{passwordReset.resetPassword()} & \PUB\\
\endcontrols

\subsubsection{Profilseite}\label{page_profile}

\begincontrols[account/profile]
    % welche sichtbarkeit
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{id} & \multirow{2}{*}{\USR}\\
    & \M{value} & \MB{profile.user.id} &\\
    \INP & \M{value} & \MB{profile.user.firstName} & \USR\\
    \INP & \M{value} & \MB{profile.user.lastName} & \USR\\
    \PAS & \M{value} & \MB{profile.password} & \USR\\
    \PAS & \M{value} & \MB{profile.confirmedPassword} & \USR\\
    \INP & \M{value} & \MB{profile.user.emailAddress} & \USR\\
    \INP & \M{value} & \MB{profile.user.zipCode} & \USR\\
    \INP & \M{value} & \MB{profile.user.city} & \USR\\
    \INP & \M{value} & \MB{profile.user.street} & \USR\\
    \INP & \M{value} & \MB{profile.user.streetNumber} & \USR\\
    \DRP & \M{value} & \MB{profile.user.role} & \ADM\\
    \CHK & \M{value} & \MB{profile.user.accountStatus} & \ADM\\
    \INP & \M{value} & \MB{profile.user.lendingPeriod} & \ADM\\
    \BTN & \M{action} & \MB{profile.save()} & \USR\\
    \LNK & \M{value} & \hyperref[page_my_copies_ready_for_pickup]{ \M{account/my-copies-ready-for-pickup.xhtml}} & \USR\\
    \LNK & \M{value} & \hyperref[page_my_borrowed_copies]{ \M{account/my-borrowed-copies.xhtml}} & \USR\\
    \BTN & \M{action} & \MB{profile.delete()} & \USR\\
\endcontrols

\subsubsection{Registrierungsseite}\label{page_registration}

\begincontrols[public/registration]
    \INP & \M{value} & \MB{registration.user.firstName} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.lastName} & \ANO/\ADM\\
    \PAS & \M{value} & \MB{registration.password} & \ANO/\ADM\\
    \PAS & \M{value} & \MB{registration.confirmedPassword} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.emailAddress} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.zipCode} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.city} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.street} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.streetNumber} & \ANO/\ADM\\
    \DRP & \M{value} & \MB{registration.user.role} & \ADM\\
    \BTN & \M{action} & \MB{registration.register()} & \ANO/\ADM\\
\endcontrols

\subsubsection{Verwaltungsseite}\label{page_administration}

\begincontrols[admin/administration]
    \INP & \M{value} & \MB{administration.application.returnPeriod} & \ADM\\
    \INP & \M{value} & \MB{administration.application.warningPeriod} & \ADM\\
    \INP & \M{value} & \MB{administration.application.pickupPeriod} & \ADM\\
    \INP & \M{value} & \MB{administration.application.name} & \ADM\\
    \CHK & \M{value} & \MB{administration.application.registerStatus} & \ADM\\
    \INP & \M{value} & \MB{administration.application.emailAddressSuffixRegEx} & \ADM\\
    \DRP & \M{value} & \MB{administration.application.theme} & \ADM\\
    \tag{h}{inputFile} & \M{value} & \MB{administration.application.logo} & \ADM\\
    \BTN & \M{action} & \MB{administration.save()} & \ADM\\
    \LNK & \M{value} & \hyperref[page_registration]{\M{public/registration.xhtml}} & \ADM\\
    \LNK & \M{value} & \hyperref[page_medium_schema_editor]{\M{admin/medium-schema-editor.xhtml}} & \ADM\\
    \LNK & \M{value} & \hyperref[page_lending_period_violations]{\M{admin/lending-period-violations.xhtml}} & \ADM\\
    \LNK & \M{value} & \hyperref[page_user_search]{\M{admin/user-search.xhtml}}& \ADM\\
    \INP & \M{value} & \MB{administration.userSearchTerm} & \ADM\\
    \BTN & \M{action} & \MB{administration.searchUser()} & \ADM\\
\endcontrols

\end{landscape}

%----------------------------------------------------------------------Kapitel 7--------------------------------------------------------------------------------------------

\section{Datenbankschema}
\sectionauthor{Jonas Picker}
In diesem Abschnitt wird die Umwandlung des ER-Diagramms (Siehe Entwurf Kapitel 7) in ein relationales Datenbankschema behandelt und untersucht. Der verwendete SQL-Dialekt ist \hyperlink{https://www.postgresql.org/}{PostgreSQL}. Der Code zum erstellen des Datenbankschemas ist \hyperlink{SQLCode}{anbei}.
\subsection{Umwandlungsentscheidungen}
\textbf{Starke Entitäten:} Die starken Entitäten \hyperlink{Medium}{'Medium'}, \hyperlink{Category}{'Kategorie'} und \hyperlink{User}{'Benutzer'} werden klassisch in eigene Tabellen mit den markierten Primärschlüsseln umgewandelt. \hyperlink{Application}{'Anwendung'} wird als einzeilige Tabelle mit konstantem Primärschlüssel umgesetzt. Die Spezialisierungen der Entität 'Benutzer' werden, aus Mangel an eigenen Attributen, in die Benutzertabelle mittels des neuen Attributs 'userRole' integriert. \\
\textbf{Schwache Entitäten:} Die zum Benutzer gehörige Entität 'Adresse' wird mit der \hyperlink{User}{Benutzertabelle} fusioniert, da wir die Adresse in unserem System nicht weiterverarbeiten und die Anzahl zusammenwohnender Nutzer verschwindend gering sein wird. Da es sich bei den Attributen 'Signatur' und 'Bibliotheksstandort' um nutzergenerierte Werte handelt, wird die vom Medium abhängige 'Exemplar'-Entität in eine \hyperlink{Copy}{Tabelle} mit dem Kompositschlüssel (\textit{mediumID, copyID}) transformiert. Mit den Entitäten \hyperlink{CustomAttribute}{'Attribut'} und \hyperlink{AttributeType}{'Attributtyp'} wird ebenso verfahren, die jeweiligen Kompositschlüssel sind (\textit{mediumID, attributeID}) und (\textit{attributeID, attributeTypeID}). \\
\textbf{Relationen:} Alle hat-ein-Relationen verschwinden. Da sich die Relationen 'markiert' und 'ausgeliehen' gegenseitig ausschließen, werden sie in der \hyperlink{Copy}{'Exemplar'-Tabelle} in einen einzigen Fremdschlüssel umgewandelt, der zusammen mit dem Verfügbarkeitsstatus die gleichen Funktionalitäten der Originalrelationen abbilden kann. Aus der Relation 'ist Kind von' entsteht ebenfalls eine eigene Spalte \textit{parent} in der \hyperlink{Category}{'Kategorie'-Tabelle}. Da der oberste Knoten der Hierarchie keinen Elternknoten besitzt, ist hier ebenfalls \texttt{NULL} erlaubt. Bei Löschung der Elternkategorie wird eine kaskadierende Löschung der Kinder vorgenommen. Die Relation 'eingeordnet unter' wird in einen Fremdschlüssel in der \hyperlink{Medium}{'Medium'-Tabelle} umgewandelt, der auch \texttt{NULL} als Wert erlaubt. Hier wird von den im ER-Diagramm spezifizierten Kardinalitäten abgewichen und Medien, die nicht manuell in eine Kategorie eingeordnet wurden, nehmen nicht an der Relation Teil (\texttt{NULL} repräsentiert den Top-Knoten). \\
\subsection{Konventionen und eigene Datentypen}
\textbf{Namenskonventionen:} Eigens definierte Datentypen und Attribute normaler Entitätstabellen werden in Camel-Case, aber klein geschrieben. Werte der \texttt{ENUM}s werden klein geschrieben. Tabellennamen sind in normalem Camel-Case.\\
\textbf{Eigene Datentypen:} Statt dem Einlesen von Strings werden im Java-Code des Systems Enums verwendet, um Zustände zu speichern. Diese werden auch in der Datenbank in Form von eigenen \hyperlink{SQLCode}{Enumerationstypen} gespeichert.\\

\newgeometry{left=1cm,right=0cm,top=0cm,bottom=0cm}
\hypertarget{SQLCode}{}
\begin{lstlisting}
CREATE TYPE userLendStatus AS ENUM (
	'DISABLED',
	'ENABLED'
);

CREATE TYPE userVerificationStatus AS ENUM (
	'VERIFIED',
	'UNVERIFIED'
);

CREATE TYPE userRole AS ENUM (
	'ADMIN',
	'STAFF',
	'REGISTERED'
);

CREATE TYPE systemRegistrationStatus AS ENUM (
	'OPEN',
	'CLOSED'
);

CREATE TYPE systemAnonAccess AS ENUM (
	'REGISTRATION',
	'OPAC'
);

CREATE TYPE registeredUserLendStatus AS ENUM (
	'MANUAL',
	'UNLOCKED'
);

CREATE TYPE copyStatus AS ENUM (
	'BORROWED',
	'READY_FOR_PICKUP',
	'AVAILABLE'
);

CREATE TYPE attributeType AS ENUM (
	'TEXT',
	'IMAGE',
	'LINK'
);

CREATE TYPE attributeMultiplicity AS ENUM (
	'SINGLE_VALUED',
	'MULTI_VALUED'
);

CREATE TYPE mediumPreviewPosition AS ENUM (
	'FIRST',
	'SECOND',
	'THIRD',
	'FOURTH',
	'HIDDEN'
);

CREATE TYPE attributeModifiability AS ENUM (
	'MODIFIABLE',
	'STATIC'
);
\end{lstlisting} 
\hypertarget{User}{}
\begin{lstlisting}
CREATE TABLE Users (
	userID SERIAL,
	emailAddress VARCHAR(100) NOT NULL UNIQUE,
	passwordHashSalt VARCHAR(40) NOT NULL,
	passwordHash VARCHAR(64) NOT NULL,
	name VARCHAR(100),
	surname VARCHAR(100),
	postalCode VARCHAR(20),
	city VARCHAR(100),
	street VARCHAR(100),
	houseNumber VARCHAR(20),
	token CHAR(20) UNIQUE,
	tokenCreation TIMESTAMP,
	userLendPeriod INTERVAL,
	lendStatus USERLENDSTATUS NOT NULL DEFAULT 'DISABLED',
	verificationStatus USERVERIFICATIONSTATUS NOT NULL DEFAULT 'UNVERIFIED',
	userRole USERROLE NOT NULL DEFAULT 'REGISTERED',
	
	PRIMARY KEY(userID),
	CONSTRAINT positive_tokenCreation CHECK (tokenCreation >= NOW())
);
\end{lstlisting} 
\hypertarget{Application}{}
\begin{lstlisting}
CREATE TABLE Application (
	one SERIAL,
	bibName VARCHAR(100),
	emailRegEx VARCHAR(200),
	contactInfo TEXT,
	imprintInfo TEXT,
	privacyPolicy TEXT,
	bibLogo BYTEA,
	globalLendLimit INTERVAL,
	globalMarkingLimit INTERVAL,
	reminderOffset INTERVAL,	
	registrationStatus SYSTEMREGISTRATIONSTATUS NOT NULL DEFAULT 'OPEN',
	lookAndFeel VARCHAR(40) NOT NULL,
	anonRights SYSTEMANONACCESS NOT NULL DEFAULT 'OPAC',
	userLendStatus REGISTEREDUSERLENDSTATUS NOT NULL DEFAULT 'UNLOCKED'	
);
\end{lstlisting}
\hypertarget{Medium}{}
\begin{lstlisting}
CREATE TABLE Medium ( 
	mediumID SERIAL,
	hasCategory INTEGER,
	
	PRIMARY KEY(mediumID),
	CONSTRAINT fk_Category 
		FOREIGN KEY(hasCategory) 
			REFERENCES Category(categoryID) 
				ON DELETE SET NULL
);
\end{lstlisting} 
\hypertarget{Category}{}
\begin{lstlisting}
CREATE TABLE Category (
	categoryID SERIAL,
	title VARCHAR(100) NOT NULL,
	description TEXT,
	parentCategoryID INTEGER,
	
	PRIMARY KEY(categoryID),
	CONSTRAINT fk_Category
		FOREIGN KEY(parentCategoryID)
			REFERENCES Category(categoryID) 
				ON DELETE CASCADE
);
\end{lstlisting} 
\hypertarget{CustomAttribute}{}
\begin{lstlisting}
CREATE TABLE CustomAttribute (
	attributeID SERIAL,
	mediumID INTEGER NOT NULL,
	attributeName VARCHAR(40) NOT NULL,
	attributeValue BYTEA,
	
	PRIMARY KEY(mediumID, attributeID),
	CONSTRAINT fk_Medium 
		FOREIGN KEY(mediumID) 
			REFERENCES Medium(mediumID) 
				ON DELETE CASCADE
);
\end{lstlisting} 
\hypertarget{AttributeType}{}
\begin{lstlisting}
CREATE TABLE AttributeType (
	typeID SERIAL,
	attributeID INTEGER NOT NULL,
	previewPosition ATTRIBUTEPREVIEWPOSITION NOT NULL DEFAULT 'HIDDEN',
	multiplicity ATTRIBUTEMULTIPLICITY NOT NULL DEFAULT 'SINGLE_VALUED',
	modifiability ATTRIBUTEMODIFIABILITY NOT NULL DEFAULT 'MODIFIABLE',
	dataType ATTRIBUTEDATATYPE NOT NULL DEFAULT 'TEXT',
	
	PRIMARY KEY(attributeID, typeID),
	CONSTRAINT fk_CustomAttribute 
		FOREIGN KEY(attributeID) 
			REFERENCES CustomAttribute(attributeID) 
				ON DELETE CASCADE
);
\end{lstlisting}
\hypertarget{Copy}{}
\begin{lstlisting}
CREATE TABLE Copy ( 
	copyID SERIAL,
	mediumID INTEGER NOT NULL,
	signature VARCHAR(100) UNIQUE,
	bibPosition VARCHAR(100),
	status COPYSTATUS NOT NULL DEFAULT 'AVAILABLE',
	deadline TIMESTAMP,
	actor INTEGER,
	
	PRIMARY KEY(fromMedium, copyID),
	CONSTRAINT fk_Medium 
		FOREIGN KEY(mediumID) 
			REFERENCES Medium(mediumID) 
				ON DELETE CASCADE,
	CONSTRAINT fk_User 
		FOREIGN KEY(actor) 
			REFERENCES User(userID) 
				ON DELETE RESTRICT,
	CONSTRAINT positive_deadline CHECK ((deadline IS NULL) OR (deadline > NOW()),
	CONSTRAINT available_constraint CHECK (status != 'available' OR actor IS NULL)
);

CREATE FUNCTION check_status_validity() RETURNS TRIGGER AS 
$$
	BEGIN
			--forbidden: marking lent copy
		IF (OLD.status == 'lent') AND (NEW.status == 'marked') THEN 
		RAISE EXCEPTION 'Cannot mark a lent copy';
				--forbidden: lending lent copy
		ELSE IF (OLD.status == 'lent') AND (NEW.status == 'lent') THEN 
		RAISE EXCEPTION 'Copy is already lent';
				--forbidden: marking marked copy
		ELSE IF (OLD.status == 'marked') AND (NEW.status == 'marked') THEN 
		RAISE EXCEPTION 'Copy is already marked';
				--forbidden: an available copy has no actor
		ELSE IF (NEW.status == 'available') AND (NEW.actor IS NOT NULL) THEN 
		RAISE EXCEPTION 'An available copys actor must be NULL';
					--negated allowed transition: user picks up his marked copy
		ELSE IF NOT ((OLD.status == 'marked' AND NEW.status == 'lent') AND (OLD.actor == NEW.actor)) THEN
		RAISE EXCEPTION 'A marked copy can only be lent by the marking user!';	
						--negated allowed transition: direct lend
		ELSE IF NOT (	   ((OLD.status == 'available') AND (NEW.status == 'lent')) 
						--negated allowed transition: marking period expired
						OR ((OLD.status == 'marked') AND (NEW.status == 'available'))  
						--negated allowed transition: makes no sense but doesn't hurt
						OR ((OLD.status == 'available') AND (NEW.status == 'available'))
					) 
		THEN 
		RAISE EXCEPTION 'Invalid operation';
		RETURN NEW;
	END IF;
	END;
$$
LANGUAGE plpgsql;
   
CREATE TRIGGER 
	BEFORE UPDATE OF status ON Copy
	FOR EACH ROW 
	EXECUTE PROCEDURE check_validity();

\end{lstlisting}
\restoregeometry

\subsection{Normalformanalyse}
Zunächst werden die erstellten Tabellen in klassischer Notation für Relationen aufgelistet: \\
\\
\textbf{User}:\{ \textit{userID, emailAddress, passwordHashSalt, passwordHash, name, surname, postalCode, city, street, houseNumber, token, tokenCreation, userLendPeriod, lendStatus, verificationStatus,\\ userRole} \}\\
\textbf{Medium}:\{ \textit{mediumID, hasCategory} \}\\
\textbf{Application}:\{ \textit{one, bibName, emailRegEx, contactInfo, imprintInfo, privacyPolicy, bibLogo, globalLendLimit, globalMarkingLimit, reminderOffset, registrationStatus, lookAndFeel, anonRights,\\ userLendStatus} \}\\
\textbf{Category}:\{ \textit{categoryID, title, description, parent} \}\\
\textbf{CustomAttribute}:\{ \textit{attributeID, fromMedium, attributeName, attributeValue} \}\\
\textbf{AttributeType}:\{ \textit{typeID, fromAttribute, previewPosition, multiplicity, modifiability, dataType} \}\\
\textbf{Copy}:\{ \textit{copyID, fromMedium, signature, bibPosition, status, deadline, actor} \}\\
\\
Aus den funktionalen Abhängigkeiten zwischen den Attributen ergeben sich verschiedene Superschlüssel für die Relationen. Die Superschlüsselmöglichkeiten sind eingeklammert.\\
\\
\textbf{User}:\{ (\texttt{userID}), (\texttt{emailAddress}), (\texttt{token}), (\texttt{userID, token}), (\texttt{userID, emailAddress}), \\ (\texttt{emailAddress, token}), (\texttt{userID, emailAddress, token}), \textit{passwordHashSalt, passwordHash, name, surname, postalCode, city, street, houseNumber, tokenCreation, userLendPeriod, lendStatus, verificationStatus, userRole} \}
Es gibt sowohl Städte mit mehreren Postleitzahlen, als auch Postleitzahlen, die mehrere Städte/Dörfer einschließen. Somit legen sich die Attributwerte nicht gegenseitig eindeutig fest und es besteht keine funktionale Abhängigkeit.\\
\textbf{Medium}:\{ (\texttt{mediumID}), \textit{hasCategory} \}\\
\textbf{Application}:\{ (\texttt{one}),\textit{ bibName, emailRegEx, contactInfo, imprintInfo, privacyPolicy, bibLogo, globalLendLimit, globalMarkingLimit, reminderOffset, registrationStatus, lookAndFeel, anonRights,\\ userLendStatus} \}\\
\textbf{Category}:\{ (\texttt{categoryID}), \textit{title, description, parent} \}\\
\textbf{CustomAttribute}:\{ (\texttt{fromMedium, attributeID}),  \textit{attributeValue, attributeName} \}\\
\textbf{AttributeType}:\{ (\texttt{fromAttribute, typeID}), \textit{previewPosition, multiplicity, modifiability, dataType} \}\\
\textbf{Copy}:\{ (\texttt{fromMedium, copyID}), (\texttt{fromMedium, signature}), (\texttt{fromMedium, signature, copyID}), \textit{bibPosition, status, deadline, actor} \}
Die Attribute \textit{status, deadline, actor} beeinflussen sich gegenseitig, \textit{deadline} hängt jedoch noch von anderen Limits außerhalb dieser Relation ab und wird somit nicht eindeutig durch Änderungen von \textit{actor} oder \textit{status} festgelegt. Da nur der Status 'available' den Wert \texttt{NULL} im Attribut \textit{actor} impliziert und alle anderen Werte keine eindeutige Zuordnung festlegen, gibt es hier keine schlüsselunabhängigen Abhängigkeiten.\\
\\
Aus den minimalen Superschlüssel ergeben sich die Kandidatenschlüsselmöglichkeiten. Da alle Attributewerte nur atomare Werte annehmen können, ist das Schema in erster Normalform. Da es ebenfalls kein nichtprimes\footnote{Ein Attribut, welches nicht Teil eines Kandidatenschlüssels ist.} Attribut gibt, welches von einer echten Teilmenge eines Schlüssel funktional abhängig ist, gilt für das Schema die zweite Normalform. Für jede funktionale Abhängigkeit \textit{X $\rightarrow$ A} gilt außerdem: Entweder ist \textit{A} prim oder\textit{X} ist ein Superschlüssel der Relation. Damit folgt die dritte Normalform. Ohne schlüsselunabhängige Abhängigkeiten bleiben zur Untersuchung nur noch Attribute der überlappenden Kandidatenschlüssel übrig. In keine Richtung bestehen weder zwischen \textit{userID $\leftrightarrow$ token}, \textit{emailAddress $\leftrightarrow$ token} oder \textit{emailAddress $\leftrightarrow$ userID} noch zwischen \textit{signature $\leftrightarrow$ copyID} funktionale Zusammenhänge. Das Relationenschema ist somit in Boyce-Codd-Normalform, da alle Abhängigkeiten von Superschlüsseln ausgehen.

%----------------------------------------------------------------------Kapitel 8--------------------------------------------------------------------------------------------
\newpage
\section{Datenfluss}
\sectionauthor{Sergei Pravdin}
Die Kommunikation zwischen den Klassen und die Interaktionen des Systems werden durch die Sequenzdiagramme abgebildet. Um einen Datenfluss beispielhaft zu zeigen, werden die folgenden beiden Szenarien vorgelegt: Zuerst bucht ein angemeldeter Nutzer ein Medium-Exemplar erfolgreich zur Ausleihe. Im zweiten Szenario bucht ein angemeldeter Nutzer ein Medium-Exemplar erfolglos zur Ausleihe, weil die Verbindung mit der Datenbank fehlgeschlagen ist. Das System ist so eingestellt, dass die angemeldeten Nutzer Zugriff auf die Medien haben. Der Nutzer möchte ein Exemplar des Mediums 'Programmieren lernen' buchen. Im System existiert das Medium mit dem Titel 'Programmieren lernen' und mit der Signatur (ID) '17RE'. Das Exemplar mit der Signatur (ID) '17RE (+1)' gehört zu dem genannten Medium und ist für eine Buchung verfügbar. Der Nutzer ruft die Mediumsseite 'medium.xhtml?id=17RE' auf.
\subsection{Interaktionen beim erfolgreichen Buchen eines Medium-Exemplars}
\subsubsection{Initialisierung der Mediumsseite}
Beim Laden der Mediumsseite wird zuerst die Methode 'init' als @PostConstruct aufgerufen. Die 'init'-Methode erzeugt ein Medium-DTO, das Medium-DTO hat eine Kollektion der CopyDTOs und eine Kollektion der AttributeDTOs, folglich werden sie vom Medium-DTO erstellt. Der Nutzer bekommt das MediumDTO und setzt eine Medium-ID, die aus dem 'viewParam' zur Verfügung gestellt wird. Danach wird die 'viewAction()' durchgeführt, welche die Mediumsseite durch die statische Methode aus dem Medium-DAO liefern muss. Das Medium-DAO bekommt auf der Persistence-Schicht eine Verbindung von der Singleton-ConnectionPool-Klasse durch die Methoden 'getInstance()' und 'getConnection()'. Im Körper der Methode 'loadMedium' wird eine SELECT-Anfrage durchgeführt, danach gibt das Medium-DAO die Verbindung durch die Methode 'releaseConnection' frei. Das Medium-DAO befüllt mit den von der Datenbank erhaltenen Attributen das Medium-DTO (inkl. CopyDTOs und AttributeDTOs) und gibt es dem Medium-BB zurück. Die Mediumsseite ist nun durch die Methode 'getAttributes' des Medium-DTOs vollständig geladen.
\subsubsection{Buchen eines Exemplars}
Durch die Methode 'getCopies' des Medium-DTOs ist das gewünschte Exemplar für den Nutzer sichtbar. Der Nutzer klickt auf den Buchen-Button des Exemplars. Beim Klicken ruft der Nutzer die Methode 'pickUpAnyCopy' des Medium-BBs auf. Im Körper dieser Methode wird die Methode 'checkAccountStatus()' aus dem UserSession-BB aufgerufen, um zu prüfen, ob der Nutzer Zugriff auf die Funktion Buchen hat. Das UserSession-Bean meldet dem Medium-BB ein positives Ergebnis (OPENED-Status) zurück. Das Medium-BB ruft die statische Methode 'MediumDAO.pickUpAnyCopy(mediumDTO)' auf. Das Medium-DAO bekommt durch die Methoden 'getInstance()' und 'getConnection()' auf der Persistence-Schicht eine Verbindung von der Singleton-ConnectionPool-Klasse. Falls ein availabilityStatus des Exemplars immer noch 'AVAILABLE' ist, wird wird eine UPDATE-Anfrage im Körper der Methode 'loadMedium'  durchgeführt. Im Anschluss gibt das Medium-DAO die Verbindung durch die Methode 'releaseConnection' frei. Als Ergebnis der Methode 'pickUpAnyCopy' bekommt das Medium-BB 'true'. Das Medium-BB vergibt den neuen Status 'MARKEDTOCOLLECT' an das Exemplar. Der Nutzer bekommt eine Nachricht durch die statische Methode 'RessourceBandleHandler.getValue()' und die Buchung ist erfolgreich abgeschlossen. Vom Ressource-Bandle-Handler wird der Nutzer entsprechend benachrichtigt.
\newgeometry{left=0cm,right=0cm,top=0cm,bottom=2cm}
\newpage
\begin{figure}[h]
    \centering
    \includegraphics[width = 50em]{Sequenzdiagramm-success-v3.2}
    \caption{Interaktionen beim erfolgreichen Buchen eines Medium-Exemplars}
    \label{Sequenzdiagramm}
\end{figure}
\restoregeometry

\subsection{Interaktionen beim Buchen eines Medium-Exemplars mit fehlender Datenbankverbindung}
\subsubsection{Initialisierung der Mediumsseite}
Beim Laden der Mediumsseite wird zuerst die Methode 'init' als @PostConstruct aufgerufen. Die 'init'-Methode erzeugt ein Medium-DTO, das Medium-DTO hat eine Kollektion der CopyDTOs und eine Kollektion der AttributeDTOs, folglich werden sie vom Medium-DTO erstellt. Der Nutzer bekommt das MediumDTO und setzt eine Medium-ID, die aus dem 'viewParam' zur Verfügung gestellt wird. Danach wird die 'viewAction()' durchgeführt, welche die Mediumsseite durch die statische Methode aus dem Medium-DAO liefern muss. Das Medium-DAO bekommt durch die Methoden 'getInstance()' und 'getConnection()' auf der Persistence-Schicht eine Verbindung von der Singleton-ConnectionPool-Klasse. Aufgrund der fehlenden Verbindung mit der Datenbank kann das Medium-DAO keine SELECT-Anfrage durchführen, deshalb bekommt das Medium-DAO einen SQL-Exception. Das Medium-DAO wandelt den SQL-Exception in den DataAccess-Exception um, danach gibt das Medium-DAO eine Verbindung durch die Methode 'releaseConnection' frei. Im nächsten Schritt wirft das MediumDAO einen Data-Access-Exception in den Medium-BB ein. Der Nutzer ruft die Methode 'handle' des ExceptionHandlers auf; der ExceptionHandler gibt den Fehler durch die Methoden 'getInstance()' und 'addValue(Data-Access-Exception)' in die Singleton-Logger-Klasse ein. Danach bekommt der ExceptionHandler eine Message vom Resource-Bandle-Handler und setzt diese Message in die ErrorBB-Klasse ein.
\subsubsection{Weiterleitung zur Fehlerseite}
Als Ergebnis der Methode 'handle' liefert der ExceptionHandler dem Nutzer den Link zur Fehlerseite. Das Laden der Fehlerseite wird auf dem Sequenzdiagramm nicht abgebildet.

\newpage

\newgeometry{left=0cm,right=0cm,top=0cm,bottom=2cm}

\begin{figure}[h]
	\hypertarget{Fehlersequenz}{}
    \centering
    \includegraphics[width = 50em]{Sequenzdiagramm-exception-v4.1}
    \caption{Interaktionen beim Buchen eines Medium-Exemplars mit fehlender Datenbankverbindung}
    \label{Sequenzdiagramm}
\end{figure}

\restoregeometry
\newpage

%----------------------------------------------------------------------Kapitel 9--------------------------------------------------------------------------------------------
\section{Sicherheit}
\sectionauthor{Jonas Picker}
Dieses Kapitel baut auf dem Abschnitt 'technische Systemsicherheit' des Entwurfs auf und vertieft Sicherheitsaspekte der Anwendung.
\subsection{Injections}
\hypertarget{Injections}{Das} direkte Interpretieren von nutzergenerierten Eingaben wird unterbunden.\\
\textbf{SQL:} Da unser System postgreSQL als Datenbankanfragesprache verwendet, wird in den \hyperlink{DAOs}{Data Access Objects}!!! im Java-Code mit \hyperlink{https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html}{'PreparedStatements'} gearbeitet. Da die eigentliche Anfrage nicht zusammen mit den vom Nutzer stammenden Parametern interpretiert wird, hat das Einschleusen von SQL-Code in diese Parameter keinen Effekt auf die Datenbank.\\
\textbf{HTML/JavaScript:} \hypertarget{XSS}{Um} das Einschleusen von HTML- (und eingebetteten JavaScript-) Code, in nutzergenerierte Inhalte der Webseite zu verhindern, verfügen die JSF-Facelet Elemente zum Anzeigen nutzergenerierter Inhalte über integrierte Escaping-Funktionen. Konkret: Der implizite Attributwert \texttt{'escape'} des Facelet-Element \hyperlink{https://docs.oracle.com/javaee/7/javaserver-faces-2-2/vdldocs-facelets/h/outputText.html}{\texttt{<h:outputText>}} ist \texttt{'true'}, sensitive \texttt{XML} und \texttt{HTML} Sonderzeichen werden somit automatisch escapet und damit wird verhindert, dass eingeschleuste Code-Snippets von Browsern anderer Nutzer interpretiert oder ausgeführt werden.
\subsection{Insecure Direct Object References}
Unbefugte direkte Zugriffe auf zugangsbeschränkte Teile der Anwendung werden abgefangen.\\ 
Nutzer könnten versuchen, manuell die URL-Parameter in der Adresszeile zu verändern. In der Medienansicht könnte man so z.B. durch Ändern der ID auf die Ansicht eines anderen Mediums gelangen, dies ist jedoch nicht bei allen Facelets so unproblematisch. Bei einer Anfrage werden erste Maßnahmen der Zugriffskontrolle nach der \texttt{RESTORE\_VIEW}-Phase im \hyperlink{PhaseListener}{Trespaslistener}!!! vorgenommen. Hier wird über die Sessionmap die Nutzerrolle und der Loginstatus mit der URL-Struktur der Anfrage abgeglichen und bei invalidem Zugriff auf eine \hyperlink{invalidaccess}{Fehlerseite}!!! umgeleitet. Um denselben Zugriffsprozess wie im Mediumsansicht-Beispiel bei der Profilseite zu verhindern, wird im jeweiligen Backing-Bean mittels \hyperlink{https://docs.oracle.com/javaee/7/api/javax/annotation/PostConstruct.html}{\texttt{@PostConstruct}} sofort nach Instanzierung auf die URL-Parameter zugegriffen und geprüft, ob der Nutzer berechtigt ist, andere Profile als sein eigenes anzusehen. 
\subsection{Session Fixation}
Wie bereits im Abschnitt 'Session-Hijacking' des Entwurfs erwähnt, tauschen wir unmittelbar nach dem Login eines Benutzers im \hyperlink{Login}{Backing-Bean}!! den Identifikator der internen \texttt{HttpSession} mittels \texttt{HttpServletRequest.changeSessionID()}  aus. Hauseigene \hyperlink{Session}{Session}!!!-\hypertarget{safetyfirst}{Objekte} werden nur für eingeloggte Nutzer angelegt und beim Login werden auch sonst keine vorherigen Zustandsinformationen übernommen. Zusätzlich zur Zerstörung beim Logout haben alle Sessions Tomcat-intern einen Inaktivitätstimeout von 30 Minuten, den wir beibehalten werden (andere Servlet Container verwenden denselben Timeout).
\subsection{Userinput}
Neben dem Vorbeugen von \hyperlink{Injections}{Injections} gibt es weitere Maßnahmen zum Absichern von Nutzereingaben.\\
\textbf{Admins:} Ausnahmen von den \hyperlink{XSS}{XSS-Gegenmaßnahmen} bilden das Impressum, die Datenschutzerklärung und  die Kontaktinformationen, da wir Administratoren beim editieren mehr Gestaltungsmöglichkeiten geben wollen. Hier würder der Browser \texttt{HTML}-Zeichen interpretieren, da dies explizit mit \texttt{<h:outputText\hspace{2mm}escape=\dq false\dq\hspace{2mm}value=\dq\#\{\textit{backingbean.dto.value}\}\dq/>} erlaubt wird. Andere Nutzerrollen haben keinen schreibenden Zugriff auf diese Teile der Webseite.\\
\textbf{Passwörter:} Eine Mindestlänge von 8 Zeichen in Groß- und Kleinschreibung und das enthalten einer Zahl wird durch den \hyperlink{Validator}{PasswordValidator}!!! sichergestellt. Registrierte Passwörter werden nicht im Klartext gespeichert, sondern in der Klasse \hyperlink{Hash}{PasswordHashingModule}!!! mittels \hyperlink{}{\texttt{!!!}}!!! verarbeitet. Diese benutzt die Java-interne SHA3-256 Hashingfunktion der Klasse \hyperlink{https://docs.oracle.com/javase/9/docs/api/java/security/MessageDigest.html}{MessageDigest} (\texttt{.pdf} Downloadlink mit Spezifikation \hyperlink{https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf}{hier}). Das Ergebnis wird als 64 Buchstaben lange Hexadezimalzahl in der \hyperlink{User}{User-Tabelle} gespeichert. Durch vorheriges Anhängen eines Salts\footnote{Ein 40 Zeichen langer, zufällig generierter String.} an das Passwort werden Kollisionen der Hashfunktion noch unwahrscheinlicher und gleiche Passwörter entsprechen nicht mehr demselben Hashwert.\\
\textbf{E-Mail-Adressen:} Bei der Registrierung eines neuen Nutzerkontos oder der Änderung der Adresse wird der vom Administrator festgelegte RegEx zuerst bedient und danach wird auf Duplikate in der Datenbank geprüft. Dies geschieht im \hyperlink{Validator}{EmailValidator}!!!. Der anschließende Verifizierungsprozess stellt die Gültigkeit der Adresse sicher.
\subsection{System Secrecy}
Die Hintergrundprozesse und Technologien werden bestmöglich versteckt.\\
\textbf{Rollenisolation:} Ist der Nutzer berechtigt, das unter der URL erreichbare Facelet zu sehen, werden, anhand der Nutzerrolle,vorhandene Knöpfe und Eingabefelder je nach Rollenberechtigungen gerendert oder ausgeblendet. Dies wird durch einen Bedingungscheck in den Facelet-Elementen gesteuert (z.B. Komponente exklusiv für registrierte Nutzer und höher:\\ \texttt{<ui:component\hspace{2mm}rendered=\dq\#\{not empty userrole\}\dq>\textit{example}</ui:component>} mittels des Sessionattributes 'userrole'). So haben Rollen der unteren Hierarchieschichten keine Information über die Möglichkeiten der darüber liegenden.\\
\textbf{Technologiemaskierung:} Der XML-Dialekt der Facelet-Sprache ist für den Benutzer undurchsichtig, die Sprache wird durch das Framework in HTML und JavaScript mit der Endung '.xhtml' umgewandelt. Weder das verwendete Datenbanksystem noch das JSF-Framework sind für den Benutzer ersichtlich. Im laufenden System werden bei Fehlermeldungen eigene Fehlerseiten erstellt und keine Stack-Traces ausgegeben, um die Tomcat-eigenen Fehlerseiten nicht preiszugeben. Hierzu gibt es, zusätzlich zu einer Standartfehlerseite, für die typischen \texttt{HTTP}-Fehlercodes (bzw. auftretende unchecked-Exceptions die  das Anzeigen einer internen Fehlerseite zur Folge hätten) eigene statische Fehlerseiten, die über \texttt{<error-page><error-code>}/\texttt{<error-page><exception-type>}-Mappings in der \texttt{web.xml} registriert sind. Problematische checked-Exceptions werden über den \hyperlink{ExceptionHandler}{ExceptionHandler}!!! zu einer dynamisch befüllten \hyperlink{dynamicerror}{Fehlerseite}!!! geleitet. Der \hyperlink{ExceptionHandler}{ExceptionHandler}!!! selbst wird mittels des Factory-Patterns \hyperlink{ExceptionHandlerFactory}{hier} erzeugt.

\end{document}
