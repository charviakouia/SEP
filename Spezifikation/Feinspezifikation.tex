\documentclass{article}

\usepackage[ngerman]{babel}
\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{changepage}
\usepackage{booktabs}
\usepackage{float}
\usepackage{tabulary}
\usepackage{multirow}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{lscape}

\graphicspath{ {./images/} }
\setlength\parindent{0pt}

\makeatletter
\newcommand{\sectionauthor}[1]{
	{\parindent 0em \large \scshape Autor: #1 \par \nobreak \vspace*{1em}}
	\@afterheading
}
\newcommand{\specification}[3]{
	{\parindent 0.5em \hangindent 3em \hypertarget{spec:#1:#2}{\textbf{/#1#2/}} #3 \par \nobreak \vspace*{0.5em}}
}
\makeatother

\title{Bibliotheksanwendung - Feinspezifikation}
\date{\today\\v1.0}
\author{
	Ivan Charviakou\\
	León Liehr\\
	Mohamad Najjar\\
	Jonas Picker\\
	Sergei Pravdin
}

\begin{document}
\maketitle
\begin{figure}[h]
	\centering
	\includegraphics[width = 30em]{Logo}
\end{figure}
\newpage
\tableofcontents
\newpage

%----------------------------------------------------------------------Kapitel 1--------------------------------------------------------------------------------------------

\section{Einleitung}
Bei diesem Dokument handelt es sich um die Feinspezifikation unseres Bibliothekssystems. Es baut direkt auf dem vorangegangenen Entwurf auf und enthält einen noch genaueren Umriss der zu erstellenden Applikation.

%----------------------------------------------------------------------Kapitel 2--------------------------------------------------------------------------------------------

\section{Projektübersicht}
\sectionauthor{Ivan Charviakou}

\subsection{Paketübersicht und Ordnerstruktur}
Das angegebene Diagramm stellt die MVC-Architektur mit den Beziehungen zwischen den einzelnen Komponenten anhand der gegebenen Applikation dar.
Dabei folgt die Komponentenaufteilung der Paketstruktur der Applikation und es werden die Paketnamen zusammen mit den wichtigsten darin enthaltenen Klassen / Komponenten / Funktionalitäten angegeben.
Zudem entsprechen die Farben, die die Pakete im Diagramm besitzen, den Farben im nachfolgenden Klassendiagramm. \vspace{0.5em}

Die Ordnerstruktur des Projekts wird als Ordnerbaum dargestellt.
Während die Paketstruktur im Ordner 'BiBi.src.main.java' abgebildet ist, enthält 'BiBi.src.main.webapp.view' die verwendeten Facelets mit entsprechender Rollenzuordnung. \vspace{0.5em}

\begin{figure}[ht]
	\centering
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\includegraphics[width = 19em]{Modeldiagramm}
		\caption{Modeldiagramm}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\includegraphics[width = 15em]{FileStructure}
		\caption{Ordnerstruktur}
	\end{subfigure}
\end{figure}

%----------------------------------------------------------------------Kapitel 3--------------------------------------------------------------------------------------------


%----------------------------------------------------------------------Kapitel 4--------------------------------------------------------------------------------------------
\newpage
\section{Bibliotheken}
\sectionauthor{Sergei Pravdin}

\newenvironment{controls}
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ p{7em} p{19em} p{4em} p{12em} }
            \toprule
            \textbf{Bibliothek} & \textbf{Anwendungsbereich} & \textbf{Version} & \textbf{Lizenz}\\
            \midrule
        }
        {
            \bottomrule
        \end{tabular}
    \end{table}
}

Folgende Bibliotheken bzw. Frameworks werden für die Entwicklung unseres Bibliothekssystems verwendet.

\begin{controls}
    Jakarta Server Faces (JSF) & Grafische Benutzeroberflächen des Bibliothekssystems & 3.0.0 & GNU GPL / Java Community Process\\
    JDBC-Treiber für PostgreSQL & Integration des Bibliothekssystems mit der Datenbank & 42.2.20 & GNU GPL / Java Community Process\\
    Apache Tomcat & Webserver & 10.0.2 & Apache-Lizenz 2.0\\
    Weld & Dependency Injection mittels Annotationen & 4.0.1 & Apache-Lizenz 2.0\\
    Jakarta Mail & Senden und Empfangen von E-Mails für die Verifizierung der Nutzers & 1.6.5 & CDDL 1.0, GPL 2.0, BSD\\
    Bootstrap & Anordnung der Frontend-CSS-Komponenten & 5.0.0 & MIT-Lizenz\\
\end{controls}

%----------------------------------------------------------------------Kapitel 5--------------------------------------------------------------------------------------------


%----------------------------------------------------------------------Kapitel 6--------------------------------------------------------------------------------------------


\section{View}
\sectionauthor{León Liehr}

TODO

\begin{itemize}
    \item IDs pro Element
    \item Korrekte Sichtbarkeiten
    \item Composite-Component-Definitionen für paginierte Liste etc.
    \item Manchmal fehlt repeat-Element
\end{itemize}

\newcommand{\M}[1]{\texttt{#1}} % monospaced
\newcommand{\tag}[2]{\M{#1:#2}} % JSF tag
\newcommand{\B}[1]{\#\{#1\}} % JSF binding
\newcommand{\MB}[1]{\M{\B{#1}}} % monospaced JSF binding

% @Beacon @Temporary
\renewenvironment{controls}
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ p{7em} p{25em} p{7em} }
            \toprule
            \textbf{Typ} & \textbf{Beschreibung} & \textbf{Sichtbarkeit}\\
            \midrule
        }
        {
            \bottomrule
        \end{tabular}
    \end{table}
}

\long\def\begincontrols [#1] #2\endcontrols
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ l l l l }
            \toprule
            & \multicolumn{2}{l}{\textbf{Attribut}} &\\
            \cmidrule(r){2-3}
            \textbf{Typ} & \textbf{Name} & \textbf{Wert} & \textbf{Sichtbarkeit}\\
            \midrule
            #2
            \bottomrule
        \end{tabular}
        \caption{\M{#1.xhtml}}
    \end{table}
}

\long\def\beginsubcontrols [#1][#2] #3\endsubcontrols
{
    \begin{table}[H]
        \centering
        \begin{tabular}{ l l l l }
            \toprule
            & \multicolumn{2}{l}{\textbf{Attribut}} &\\
            \cmidrule(r){2-3}
            \textbf{Typ} & \textbf{Name} & \textbf{Wert} & \textbf{Sichtbarkeit}\\
            \midrule
            #3
            \bottomrule
        \end{tabular}
        \caption{#1}
        \label{#2}
    \end{table}
}

\newcommand{\PUB}{jeder}
\newcommand{\ANO}{Anon.}
\newcommand{\USR}{Nutzer}
\newcommand{\BIB}{Mitarbeiter}
\newcommand{\ADM}{Admin.}

\newcommand{\component}[2]{\subsubsection{#1 (\texttt{#2})}}

\newcommand{\Parameter}{\paragraph*{Parameter}}

\newcommand{\BTN}{\tag{h}{commandButton}}
\newcommand{\LNK}{\tag{h}{outputLink}}
\newcommand{\INP}{\tag{h}{inputText}}
\newcommand{\PAS}{\tag{h}{inputSecret}}
\newcommand{\DRP}{\tag{h}{selectOneMenu}}
\newcommand{\CHK}{\tag{h}{selectBooleanCheckbox}}
\newcommand{\OUT}{\tag{h}{outputText}}
\newcommand{\LST}{\tag{bibi}{paginatedList}}

\begin{landscape}

\subsection{Komponenten}

JSF Composite Components.

\subsection{Seitenvorlage}\label{page_template}

JSF Templates.

\begincontrols[template]
    \tag{ui}{insert} & \M{name} & \M{title} & \\
    \tag{ui}{insert} & \M{name} & \M{content} & \\
    \tag{ui}{include} & \M{src} & \hyperref[page_header]{\M{header.xhtml}} & \\
    \tag{h}{messages} & \M{globalOnly} & \M{true} & \\
    \tag{ui}{include} & \M{src} & \hyperref[page_footer]{\M{footer.xhtml}} & \\
\endcontrols

\subsubsection{Kopfzeile}\label{page_header}

\begincontrols[header]
    \multirow{2}{*}{\tag{h}{commandButton}} & \M{id} & \M{xxx} & \\
    & \M{action} & \MB{header.displayHelpText()} & \\
    \INP & \M{value} & \MB{header.mediumSearchTerm} & \\
    \LNK & \M{value} & \hyperref[page_medium_search]{\M{public/medium-search.xhtml}} & \\
    \tag{h}{graphicImage} & \M{value} & \MB{header.application.logo} & \\
    \OUT & \M{value} & \MB{header.application.name} & \\
    \tag{h}{commandLink} & \M{action} & \MB{header.logOut()} & \\
    \LNK & \M{value} & \hyperref[page_login]{\M{public/login.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_registration]{\M{public/registration.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_profile]{\M{profile.xhtml?id=\B{header.user.id}}} & \\
\endcontrols

\subsubsection{Fußzeile}\label{page_footer}

\begincontrols[footer]
    \LNK & \M{value} & \hyperref[page_privacy_policy]{\M{public/privacy-policy.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_site_notice]{\M{public/site-notice.xhtml}} & \\
    \LNK & \M{value} & \hyperref[page_contact]{\M{public/contact.xhtml}} & \\
\endcontrols

\subsection{Seiten}

\subsection{Abzuholende Exemplare}\label{page_copies_ready_for_pickup}

\begin{controls}
    \LST & aller abzuholenden Exemplare & \BIB\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{19em} p{7em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung} & \textbf{Sichtbarkeit}\\
        \midrule
        Exemplar & \LNK & die Signatur eines Exemplars; zur Direktausleihe & \BIB\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht & \BIB\\
        Nutzer & \OUT & E-Mail-Adresse & Nicht-\ADM\\
        Nutzer & \LNK & E-Mail-Adresse; zum Profil & \ADM\\
        Zeit & \OUT & Dauer bis zum Zeitpunkt der Fristüberschreitung & \BIB\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar und Nutzer}
\end{table}

\subsection{Eigene abzuholende Exemplare}\label{page_my_copies_ready_for_pickup}

\begin{controls}
    \LST & aller abzuholenden Exemplare & \USR\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{27em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung}\\
        \midrule
        Exemplar & \OUT & die Signatur eines Exemplars\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht\\
        Zeit & \OUT & Dauer bis zum Überschreiten der Abholungsfrist\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar}
\end{table}

\subsection{Eigene ausgeliehene Exemplare}\label{page_my_borrowed_copies}

\begin{controls}
    \LST & aller ausgeliehenen Exemplare & \USR\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{27em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung}\\
        \midrule
        Exemplar & \OUT & die Signatur eines Exemplars\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht\\
        Zeit & \OUT & Dauer bis zum Überschreiten der Rückgabefrist\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar}
\end{table}

\subsection{Anmeldemaske}\label{page_login}

\begincontrols[public/login]
    \INP & \M{value} & \MB{login.user.email} & \ANO\\
    \PAS & \M{value} & \MB{login.user.password} & \ANO\\
    \BTN & \M{action} & \MB{login.logIn()} & \ANO\\
    \tag{h}{commandLink} & \M{action} & \MB{login.resetPassword()} & \ANO\\
\endcontrols

\subsection{Datenschutzerklärung}\label{page_privacy_policy}

\begincontrols[public/privacy-policy]
    % TASK do the readonly stuff!!
    \INP & \M{value} & \MB{privacyPolicy.application.privacyPolicy} & \ADM\\
    \BTN & \M{action} & \MB{privacyPolicy.save()} & \ADM\\
\endcontrols

\subsection{Direktausleihe}\label{pagw_direct_lending}

\Parameter
Optional \texttt{copy}: Signatur eines Exemplars. Füllt das erste Signatureingabefeld.

\begincontrols[staff/reactive-lending]
    \tag{bibi}{reactiveInputText} & \M{value} & \MB{directLending.user.email} & \BIB\\
    % BEACON TASK 5x vorhanden!!!!!
    \tag{bibi}{reactiveInputText} & \M{value} & \MB{COPY.signature} & \BIB\\
    \BTN & \M{action} & \MB{directLending.addSignatureInputField()} & \BIB\\
    \BTN & \M{action} & \MB{directLending.lendCopies()} & \BIB\\
\endcontrols

\subsection{E-Mail-Bestätigung}\label{page_email_confirmation}

\begincontrols[public/email-confirmation]
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{token} & \multirow{2}{*}{\PUB}\\
    & \M{value} & \MB{emailConfirmation.token} &\\
\endcontrols

\subsection{Fehlerseite}\label{page_error}

\begin{controls}
    \OUT & für den Titel der Fehlermeldung & \PUB\\
    \OUT & für die Beschreibung des Fehlers & \PUB\\
\end{controls}

\subsection{Impressum}\label{page_site_notice}

\begincontrols[public/site-notice]
    % TASK readonly for users and staff
    \INP & \M{value} & \MB{siteNotice.application.siteNotice} & \ADM\\
    \BTN & \M{action} & \MB{siteNotice.save()} & \ADM\\
\endcontrols

\subsection{Kategorienbearbeitung}\label{page_category_editor}

\begincontrols[staff/category-editor]
    \INP & \M{value} & \MB{categoryEditor.category.name} & \BIB\\
    \INP & \M{value} & \MB{categoryEditor.category.description} & \BIB\\
    \BTN & \M{action} & \MB{categoryEditor.save()} & \BIB\\
\endcontrols

\subsection{Kategorierenstöberer}\label{page_category_browser}

\begincontrols[public/category-browser]
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{categoryBrowser.searchTerm} & \PUB\\
    \BTN & \M{action} & \MB{categoryBroswer.searchCategory()} & \PUB\\
    %TODO!!!
%    Baumansicht & mancher Kategorien & \PUB\\
    \OUT & \M{value} & \MB{categoryBrowser.category.name} & \PUB\\
    \OUT & \M{value} & \MB{categoryBrowser.category.description} & \PUB\\
    \tag{h}{commandLink} & \M{action} & \hyperref[page_category_editor]{\M{staff/category-editor.xhtml}} & \BIB\\ % edit
    \tag{h}{commandLink} & \M{action} & \hyperref[page_category_editor]{\M{staff/category-editor.xhtml}} & \BIB\\ % create
    \BTN & \M{action} & \MB{categoryBroswer.delete()} & \BIB\\
    % BEAON TASK
%    \LST & aller Medien (Medienvorschauen) in der ausgewählten Kategorie; je ein \LNK zur Medienansicht & \PUB\\
\endcontrols

\subsection{Kontakt}\label{page_contact}

\begincontrols[public/contact]
    % TASK readonly for users and staff
    \INP & \M{value} & \MB{contact.application.contactInfo} & \ADM\\
    \BTN & \M{action} & \MB{contact.save()} & \ADM\\
\endcontrols

\subsection{Leihfristverstöße}\label{page_lending_period_violations}

\begin{controls}
    \LST & von Exemplaren und Nutzern & \ADM\\
\end{controls}

\begin{table}[H]
    \centering
    \begin{tabular}{ p{6em} p{6em} p{27em} }
        \toprule
        \textbf{Spalte} & \textbf{Typ} & \textbf{Beschreibung}\\
        \midrule
        Exemplar & \LNK & die Signatur eines Exemplars; zur Medienrückgabe\\
        Medium & \LNK & Medienattribut mit der Medienvorschauposition Titel; zur Mediensansicht\\
        Nutzer & \LNK & E-Mail-Adresse; zum Profil\\
        Überschreitung & \OUT & Dauer seit dem Zeitpunkt der Fristüberschreitung\\
        \bottomrule
    \end{tabular}
    \caption{Inhalt der paginierten Liste. Jede Zeile existiert pro Exemplar und Nutzer}
\end{table}

\subsection{Medienerstellung}\label{page_medium_creation}

\begincontrols[staff/medium-creation]
    % TASK pro medienattribut
    \INP & \M{value} & \MB{ATTRIBUTE} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.medium.category} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.medium.returnPeriod} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.copy.location} & \BIB\\
    \INP & \M{value} & \MB{mediumCreation.copy.signature} & \BIB\\
    \BTN & \M{action} & \MB{mediumCreation.create()} & \BIB\\
\endcontrols

\subsection{Medienrückgabe}\label{page_return_form}

\begincontrols[staff/return-form]
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{returnForm.user.email} & \BIB\\
    % TASK BEACON repeat 5 times (or more)!!!
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{COPY.signature} & \BIB\\
    \BTN & \M{action} & \MB{returnForm.addSignatureInputField()} & \BIB\\
    \BTN & \M{action} & \MB{returnForm.returnMedium()} & \BIB\\
\endcontrols

\subsection{Mediensuche}\label{page_medium_search}

\begincontrols[public/medium-search]
    \INP & \M{value} & \MB{mediumSearch.generalSearchTerm} & \PUB\\
    \BTN & \M{action} & \MB{mediumSearch.search()} & \PUB\\
    % TASK three times, converter, grouped
    \DRP & \M{value} & \MB{QUERY.operator} & \PUB\\
    % TASK three times, converter, grouped
    \DRP & \M{value} & \MB{QUERY.criterion} & \PUB\\
    % TASK three times, grouped
    \INP & \M{value} & \MB{QUERY.term} & \PUB\\
    \BTN & \M{action} & \MB{mediumSearch.addNuancedSearchQuery())} & \PUB\\
    % BEACON TEMPORARY
    \LST & & aller Suchergebnisse (als Medienvorschauen)e & \PUB\\
\endcontrols

\subsection{Mediumsansicht}\label{page_medium}

\begincontrols[public/medium]
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{id} & \multirow{2}{*}{\PUB}\\
    & \M{value} & \MB{medium.medium.id} & \\
    % TODO nur sichtbar wenn man von der Suche kommt
    \LNK & \M{value} & \hyperref[page_medium_search]{\M{public/medium-search.xhtml}} & \PUB\\
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{medium.medium.attributes} & \multirow{2}{*}{\PUB}\\
    & \M{var} & \hyperref[subcontrol_medium_attribute]{\M{attribute}} & \\
    \BTN & \M{action} & \MB{medium.saveAttributes()} & \BIB\\
    \BTN & \M{action} & \MB{medium.pickUpAnyCopy()} & \USR\\
    \OUT & \M{value} & \MB{medium.returnPeriod} & \USR\\
    \INP & \M{value} & \MB{medium.medium.returnPeriod} & \BIB\\
    \BTN & \M{action} & \MB{medium.saveReturnPeriod()} & \BIB\\
    \BTN & \M{action} & \MB{medium.delete()} & \BIB\\
    \multirow{3}{*}{\tag{h}{dataTable}} & \M{value} & \MB{medium.copies} & \multirow{3}{*}{\PUB}\\
    & \M{var} & \hyperref[data_table_medium_copies]{\M{copy}} & \\
    & \M{varStatus} & \M{status} & \\
    \tag{bibi}{reactiveInputField} & \M{value} & \MB{medium.copy.location} & \BIB\\
    \INP & \M{value} & \MB{medium.copy.signature} & \BIB\\
    \BTN & \M{action} & \MB{medium.createCopy()} & \BIB\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Attribut][subcontrol_medium_attribute]
%    \OUT & für ein Medienattribut; existiert pro Medienattribut; mehrwertige Attribute durch Komma getrennt angezeigt & \ANO, \USR\\
% TASK visibility
% TASK multivalued
\INP & \M{value} & \MB{attribute.value} & \BIB\\
% TODO existiert pro Mediena
%    \BTN & \M{action} & \MB{medium.addAttributeInputField()} zum Hinzufügen eines weiteren Attributeingabefelds; existiert pro Medienattribut & \BIB\\
\endsubcontrols

\begin{table}[H]
    \centering
    \begin{tabular}{ l l l l l }
        \toprule
        & & \multicolumn{2}{l}{\textbf{Attribut}} &\\
        \cmidrule(r){3-4}
        \textbf{\tag{h}{column}} & \textbf{Typ} & \textbf{Name} & \textbf{Wert} & \textbf{Sichtbarkeit}\\
        \midrule

%        Standort & \OUT & & \PUB\\
        Standort & \INP & \M{value} & \MB{copy.location} & \BIB\\
        Verfügbarkeit & \OUT & \M{value} & \MB{copy.availabilityStatus} & \PUB\\
%        Signatur & \OUT & & \PUB\\
        Signatur & \INP & \M{value} & \MB{copy.signature} & \BIB\\
        Aktionen & \BTN & \M{action} & \MB{medium.saveCopy(status.index)} & \BIB\\
        Aktionen & \BTN & \M{action} & \MB{medium.deleteCopy(status.index)} & \BIB\\
        Aktionen & \BTN & \M{action} & \MB{medium.cancelPickup(status.index)} & \BIB\\
        % nur sichtbar falls verfügbar TODO
        Aktionen & \tag{h}{commandLink} & \M{action} & \MB{medium.lendCopy(status.index)} & \BIB\\
        % nur falls ausgeliehen TODO
        Aktionen & \tag{h}{commandLink} & \M{action} & \MB{medium.returnCopy(status.index)} & \BIB\\
        % nur wenn nutzer darf TODO
        Aktionen & \BTN & \M{action} & \MB{medium.pickUpCopy(status.index)} & \USR\\
        \bottomrule
    \end{tabular}
    \caption{Bedienelemente pro Exemplar}
    \label{data_table_medium_copies}
\end{table}

\subsection{Mediumschemabearbeitung}\label{page_medium_schema_editor}

\begincontrols[admin/medium-schema-editor]
    \multirow{2}{*}{\tag{ui}{repeat}} & \M{value} & \MB{mediumSchemaEditor.attributes} & \multirow{2}{*}{\ADM}\\
    & \M{var} & \hyperref[subcontrol_schema_editor_attribute]{\M{attribute}} & \\
    \BTN & \M{action} & \MB{mediumSchemaEditor.addAttributeInputField()} & \ADM\\
    \BTN & \M{action} & \MB{mediumSchemaEditor.save()} & \ADM\\
\endcontrols

\beginsubcontrols[Bedienelemente pro Attribut][subcontrol_schema_editor_attribute]
\INP & \M{value} & \MB{attribute.name} & \ADM\\
\DRP & \M{value} & \MB{attribute.type} & \ADM\\
\DRP & \M{value} & \MB{attribute.multiplicity} & \ADM\\
\DRP & \M{value} & \MB{attribute.position} & \ADM\\
\BTN & \M{action} & \MB{mediumSchemaEditor.deleteAttribute(attribute.id)} & \ADM\\
\endsubcontrols

\subsection{Nutzersuche}\label{page_user_search}

\begincontrols[admin/user-search]
    \INP & \M{value} & \MB{userSearch.searchTerm} & \ADM\\
    \BTN & \M{action} & \MB{userSearch.searchUser()} & \ADM\\
    \CHK & \M{value} & \MB{userSearch.accountStatus} & \ADM\\
    %TODO beacon
%    \LST & aller Suchergebnisse (als Medienvorschauen); je ein \LNK zur Medienansicht; nur sichtbar, wenn schon gesucht wurde & \ADM\\
\endcontrols

\subsection{Passwortzurücksetzung}\label{page_password_reset}

\begincontrols[public/password-reset]
    \multirow{2}{*}{\tag{f}{viewParam}} & \M{name} & \M{token} & \multirow{2}{*}{\PUB}\\
    & \M{value} & \MB{passwordReset.token} & \\
    \PAS & \M{value} & \MB{passwordReset.password} & \PUB\\
    \PAS & \M{value} & \MB{passwordReset.confirmedPassword} & \PUB\\
    \BTN & \M{action} & \MB{passwordReset.resetPassword()} & \PUB\\
\endcontrols

\subsection{Profilseite}\label{page_profile}

\begincontrols[account/profile]
    \INP & \M{value} & \MB{profile.user.firstName} & \USR\\
    \INP & \M{value} & \MB{profile.user.lastName} & \USR\\
    \PAS & \M{value} & \MB{profile.password} & \USR\\
    \PAS & \M{value} & \MB{profile.confirmedPassword} & \USR\\
    \INP & \M{value} & \MB{profile.user.emailAddress} & \USR\\
    \INP & \M{value} & \MB{profile.user.zipCode} & \USR\\
    \INP & \M{value} & \MB{profile.user.city} & \USR\\
    \INP & \M{value} & \MB{profile.user.street} & \USR\\
    \INP & \M{value} & \MB{profile.user.streetNumber} & \USR\\
    \DRP & \M{value} & \MB{profile.user.role} & \ADM\\
    \CHK & \M{value} & \MB{profile.user.accountStatus} & \ADM\\
    \INP & \M{value} & \MB{profile.user.lendingPeriod} & \ADM\\
    \BTN & \M{action} & \MB{profile.save()} & \USR\\
    \LNK & \M{value} & \hyperref[page_my_copies_ready_for_pickup]{ \M{account/my-copies-ready-for-pickup.xhtml}} & \USR\\
    \LNK & \M{value} & \hyperref[page_my_borrowed_copies]{ \M{account/my-borrowed-copies.xhtml}} & \USR\\
    \BTN & \M{action} & \MB{profile.delete()} & \USR\\
\endcontrols

\subsection{Registrierungsseite}\label{page_registration}

\begincontrols[public/registration]
    \INP & \M{value} & \MB{registration.user.firstName} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.lastName} & \ANO/\ADM\\
    \PAS & \M{value} & \MB{registration.password} & \ANO/\ADM\\
    \PAS & \M{value} & \MB{registration.confirmedPassword} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.emailAddress} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.zipCode} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.city} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.street} & \ANO/\ADM\\
    \INP & \M{value} & \MB{registration.user.streetNumber} & \ANO/\ADM\\
    \DRP & \M{value} & \MB{registration.user.role} & \ADM\\
    \BTN & \M{action} & \MB{registration.register()} & \ANO/\ADM\\
\endcontrols

\subsection{Verwaltungsseite}\label{page_administration}

\begincontrols[admin/administration]
    \INP & \M{value} & \MB{administration.application.returnPeriod} & \ADM\\
    \INP & \M{value} & \MB{administration.application.warningPeriod} & \ADM\\
    \INP & \M{value} & \MB{administration.application.pickupPeriod} & \ADM\\
    \INP & \M{value} & \MB{administration.application.name} & \ADM\\
    \CHK & \M{value} & \MB{administration.application.registerStatus} & \ADM\\
    \INP & \M{value} & \MB{administration.application.emailAddressSuffixRegEx} & \ADM\\
    \DRP & \M{value} & \MB{administration.application.theme} & \ADM\\
    \tag{h}{inputFile} & \M{value} & \MB{administration.application.logo} & \ADM\\
    \BTN & \M{action} & \MB{administration.save()} & \ADM\\
    \LNK & \M{value} & \hyperref[page_registration]{\M{public/registration.xhtml}} & \ADM\\
    \LNK & \M{value} & \hyperref[page_medium_schema_editor]{\M{admin/medium-schema-editor.xhtml}} & \ADM\\
    \LNK & \M{value} & \hyperref[page_lending_period_violations]{\M{admin/lending-period-violations.xhtml}} & \ADM\\
    \LNK & \M{value} & \hyperref[page_user_search]{\M{admin/user-search.xhtml}}& \ADM\\
    \INP & \M{value} & \MB{administration.userSearchTerm} & \ADM\\
    \BTN & \M{action} & \MB{administration.searchUser()} & \ADM\\
\endcontrols

\end{landscape}

%----------------------------------------------------------------------Kapitel 7--------------------------------------------------------------------------------------------


%----------------------------------------------------------------------Kapitel 8--------------------------------------------------------------------------------------------
\newpage
\section{Datenfluss}
\sectionauthor{Sergei Pravdin}
Die Kommunikation zwischen den Klassen und die Interaktionen des Systems werden durch die Sequenzdiagramme abgebildet. Um einen Datenfluss beispielhaft zu zeigen, werden die folgenden beiden Szenarien vorgelegt: Zuerst bucht ein angemeldeter Nutzer ein Medium-Exemplar erfolgreich zur Ausleihe. Im zweiten Szenario bucht ein angemeldeter Nutzer ein Medium-Exemplar erfolglos zur Ausleihe, weil die Verbindung mit der Datenbank fehlgeschlagen ist. Das System ist so eingestellt, dass die angemeldeten Nutzer Zugriff auf die Medien haben. Der Nutzer möchte ein Exemplar des Mediums 'Programmieren lernen' buchen. Im System existiert das Medium mit dem Titel 'Programmieren lernen' und mit der Signatur (ID) '17RE'. Das Exemplar mit der Signatur (ID) '17RE (+1)' gehört zu dem genannten Medium und ist für eine Buchung verfügbar. Der Nutzer ruft die Mediumsseite 'medium.xhtml?id=17RE' auf.
\subsection{Interaktionen beim erfolgreichen Buchen eines Medium-Exemplars}
\subsubsection{Initialisierung der Mediumsseite}
Beim Laden der Mediumsseite wird zuerst die Methode 'init' als @PostConstruct aufgerufen. Die 'init'-Methode erzeugt ein Medium-DTO, das Medium-DTO hat eine Kollektion der CopyDTOs und eine Kollektion der AttributeDTOs, folglich werden sie vom Medium-DTO erstellt. Der Nutzer bekommt das MediumDTO und setzt eine Medium-ID, die aus dem 'viewParam' zur Verfügung gestellt wird. Danach wird die 'viewAction()' durchgeführt, welche die Mediumsseite durch die statische Methode aus dem Medium-DAO liefern muss. Das Medium-DAO bekommt auf der Persistence-Schicht eine Verbindung von der Singleton-ConnectionPool-Klasse durch die Methoden 'getInstance()' und 'getConnection()'. Im Körper der Methode 'loadMedium' wird eine SELECT-Anfrage durchgeführt, danach gibt das Medium-DAO die Verbindung durch die Methode 'releaseConnection' frei. Das Medium-DAO befüllt mit den von der Datenbank erhaltenen Attributen das Medium-DTO (inkl. CopyDTOs und AttributeDTOs) und gibt es dem Medium-BB zurück. Die Mediumsseite ist nun durch die Methode 'getAttributes' des Medium-DTOs vollständig geladen.
\subsubsection{Buchen eines Exemplars}
Durch die Methode 'getCopies' des Medium-DTOs ist das gewünschte Exemplar für den Nutzer sichtbar. Der Nutzer klickt auf den Buchen-Button des Exemplars. Beim Klicken ruft der Nutzer die Methode 'pickUpAnyCopy' des Medium-BBs auf. Im Körper dieser Methode wird die Methode 'checkAccountStatus()' aus dem UserSession-BB aufgerufen, um zu prüfen, ob der Nutzer Zugriff auf die Funktion Buchen hat. Das UserSession-Bean meldet dem Medium-BB ein positives Ergebnis (OPENED-Status) zurück. Das Medium-BB ruft die statische Methode 'MediumDAO.pickUpAnyCopy(mediumDTO)' auf. Das Medium-DAO bekommt durch die Methoden 'getInstance()' und 'getConnection()' auf der Persistence-Schicht eine Verbindung von der Singleton-ConnectionPool-Klasse. Falls ein availabilityStatus des Exemplars immer noch 'AVAILABLE' ist, wird wird eine UPDATE-Anfrage im Körper der Methode 'loadMedium'  durchgeführt. Im Anschluss gibt das Medium-DAO die Verbindung durch die Methode 'releaseConnection' frei. Als Ergebnis der Methode 'pickUpAnyCopy' bekommt das Medium-BB 'true'. Das Medium-BB vergibt den neuen Status 'MARKEDTOCOLLECT' an das Exemplar. Der Nutzer bekommt eine Nachricht durch die statische Methode 'RessourceBandleHandler.getValue()' und die Buchung ist erfolgreich abgeschlossen. Vom Ressource-Bandle-Handler wird der Nutzer entsprechend benachrichtigt.
\newgeometry{left=0cm,right=0cm,top=0cm,bottom=2cm}
\newpage
\begin{figure}[h]
    \centering
    \includegraphics[width = 50em]{Sequenzdiagramm-success-v3.2}
    \caption{Interaktionen beim erfolgreichen Buchen eines Medium-Exemplars}
    \label{Sequenzdiagramm}
\end{figure}
\restoregeometry

\subsection{Interaktionen beim Buchen eines Medium-Exemplars mit fehlender Datenbankverbindung}
\subsubsection{Initialisierung der Mediumsseite}
Beim Laden der Mediumsseite wird zuerst die Methode 'init' als @PostConstruct aufgerufen. Die 'init'-Methode erzeugt ein Medium-DTO, das Medium-DTO hat eine Kollektion der CopyDTOs und eine Kollektion der AttributeDTOs, folglich werden sie vom Medium-DTO erstellt. Der Nutzer bekommt das MediumDTO und setzt eine Medium-ID, die aus dem 'viewParam' zur Verfügung gestellt wird. Danach wird die 'viewAction()' durchgeführt, welche die Mediumsseite durch die statische Methode aus dem Medium-DAO liefern muss. Das Medium-DAO bekommt durch die Methoden 'getInstance()' und 'getConnection()' auf der Persistence-Schicht eine Verbindung von der Singleton-ConnectionPool-Klasse. Aufgrund der fehlenden Verbindung mit der Datenbank kann das Medium-DAO keine SELECT-Anfrage durchführen, deshalb bekommt das Medium-DAO einen SQL-Exception. Das Medium-DAO wandelt den SQL-Exception in den DataAccess-Exception um, danach gibt das Medium-DAO eine Verbindung durch die Methode 'releaseConnection' frei. Im nächsten Schritt wirft das MediumDAO einen Data-Access-Exception in den Medium-BB ein. Der Nutzer ruft die Methode 'handle' des ExceptionHandlers auf; der ExceptionHandler gibt den Fehler durch die Methoden 'getInstance()' und 'addValue(Data-Access-Exception)' in die Singleton-Logger-Klasse ein. Danach bekommt der ExceptionHandler eine Message vom Resource-Bandle-Handler und setzt diese Message in die ErrorBB-Klasse ein.
\subsubsection{Weiterleitung zur Fehlerseite}
Als Ergebnis der Methode 'handle' liefert der ExceptionHandler dem Nutzer den Link zur Fehlerseite. Das Laden der Fehlerseite wird auf dem Sequenzdiagramm nicht abgebildet.

\newpage

\newgeometry{left=0cm,right=0cm,top=0cm,bottom=2cm}

\begin{figure}[h]
	\hypertarget{Fehlersequenz}{}
    \centering
    \includegraphics[width = 50em]{Sequenzdiagramm-exception-v4.1}
    \caption{Interaktionen beim Buchen eines Medium-Exemplars mit fehlender Datenbankverbindung}
    \label{Sequenzdiagramm}
\end{figure}

\restoregeometry
\newpage

%----------------------------------------------------------------------Kapitel 9--------------------------------------------------------------------------------------------


\end{document}
