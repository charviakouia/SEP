
% !TeX spellcheck = de_DE
\documentclass{article}

\usepackage[ngerman]{babel}
\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{changepage}

\graphicspath{ {./images/} }

\makeatletter
\newcommand{\sectionauthor}[1]{
	{\parindent 0em \large \scshape Autor: #1 \par \nobreak \vspace*{1em}}
	\@afterheading
}
\newcommand{\specification}[3]{
	{\parindent 0.5em \hangindent 3em \hypertarget{spec:#1:#2}{\textbf{/#1#2/}} #3 \par \nobreak \vspace*{0.5em}}
}
\makeatother

\begin{document}

%--Einleitung--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Einleitung}
\sectionauthor{Jonas Picker}
Hier wird der Entwurf des Bibliotheksmanagementsystems BiBi beschrieben. Das Dokument bezieht sich auf das Lastenheft von Christian Bachmaier und Armin Größlinger und stellt eine technische Vertiefung unseres Pflichtenhefts dar, welches im Folgenden wiederholt referenziert wird. 

%--Systemarchitektur---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Systemarchitektur}
\sectionauthor{Ivan Charviakou}

%--Klassendiagramm---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Klassendiagramm}
\sectionauthor{Mohamad Najjar}

%--JSF-Dialoge-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{JSF-Dialoge}
\sectionauthor{León Liehr}

%--Systemfunktionen----------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Systemfunktionen}
\sectionauthor{Jonas Picker}
\subsection{Technische Systemsicherheit} +Session-Hijacking
\noindent \textbf{Kommunikationsverschlüsselung:} Durch das vorrausgesetzte SSL-Zertifikat des Tomcat-Servers wird der Anwendung die Kommunikation mit dem HTTPS-Protokoll ermöglicht. Dies ist eine Ergänzung der HTTP-Kommunikation um eine Transportverschlüsselung. Zusätzlich zur Vereitelung von Abhörversuchen der an Ihren Server gesendeten Anfragen signalisieren Sie den Klienten so auch die Vertrauenswürdigkeit Ihrer Institution durch die CA-Zertifizierung.\\
\textbf{Nutzerberechtigungen:} Um zu Verhindern, dass Nutzer ohne ausreichende Berechtigungen auf zugangsbeschränkte Bereiche des Webspaces zugreifen können, werden entsprechende Maßnahmen ergriffen: Um den direkten Aufruf von Seiten, die für den Nutzer nicht zugänglich sein sollten, zu unterbinden, verwenden wir einen sogenannten Phaselistener. Wie jede JSF-Anwendung durchläuft auch unsere nach Erhalt einer Anfrage eine Reihe von Verarbeitungsphasen, bevor die Antwort an den Klienten fertiggestellt und verschickt wird. Ein Phaselistener kann während dieses Prozesses zusätzliche Integritätsbedingungen abprüfen und gegebenenfalls die Antwort auf die Anfrage verändern/verhindern. Zusätzlich wird durch das in JSF eingebaute Session-Tracking\footnote{Das Verfolgen der Klientenverbindung zwischen den eigentlich verbindungslosen HTTP-Anfragen} sichergestellt, dass die verschiedenen Nutzerrollen eine unterschiedliche Version der gleichen Seiten angezeigt bekommen, deren Funktionalitäten den Berechtigungen der Rollen entsprechen. \\
\textbf{Vorbeugen von Angriffen:} Durch geschicktes Einschleusen von SQL\footnote{Structured Query Language, eine weit verbreitete Datenbankanfragesprache}-Code in ungesicherte Formularfelder könnten Unbefugte direkten Zugriff auf die darunterliegende Datenbank erhalten. Der Datenbankzugriff in unserem System erfolgt via JDBC\footnote{Java Database Connectivity, eine universelle Datenbankschnittstelle}, welche bereits über einen Mechanismus zur Verhinderung von diesen SQL-Injections verfügt. Hierbei wird verhindert, dass von Nutzern eingegebener Text vom Managementsystem der Datenbank interpretiert wird. Ein weiterer Angriffsvektor stellt das sogenannte Cross-Site-Scripting dar. Dabei wird versucht, nutzergenerierte Teile von Websiten mit vom Browser interpretierbaren Codeabschnitten zu füllen, welche dann beim Anzeigen des Inhalts bei anderen Klienten ausgeführt werden. Es gibt verschiedene Versionen dieser Angriffsart, von denen nicht alle am Server verhindert werden können. Jedoch wird in der Anwendungslogik jede Nutzereingabe auf interpretierbaren HTML (und eingebundenen JavaScript) Code untersucht und gegebenenfalls entschärft.
\subsection{Fehlerbehandlung und Logging}
Von uns vorhergesehene Fehler und einige im Hintergrund ablaufende Prozesse werden durch einen selbst erstellten Logging-Mechanismus dokumentiert. Da dieser Mechanismus während des Entwicklungsprozesses ebenfalls nützlich ist und auf feinster Einstellung für den Anwender uninteressant sein könnte, wird es eine Option geben, die den Detailgrad und die Anzahl der ausgegebenen Meldungen festlegt. Alle Meldungen werden in eine seperate Log-Datei geschrieben und können wahlweise auf der Konsole angezeigt werden. Vorhergesehene Fehler in Abläufen werden von der Anwendung bestmöglich abgehandelt und wie erwähnt dokumentiert. Sollte jedoch ein nicht vorhergesehener Fehler auftreten, wird der Grund dafür in From der Java-eigenen Exceptions auf die Konsole ausgegeben. Durch umfangreiches Testen der Anwendung vor Auslieferung versuchen wir, Sie vor einem solchen Fall zu bewahren.
\subsection{Selbstständige Prozesse}
Im System gibt es verschiedene Fristen (Abholungsmarkierung, Ausleihrückgabe [global, pro Medium, pro Nutzer], Gültigkeit des Verifizierungs-/Zurücksetzungslinks, Mahnungszeitversatz) und damit verbundene Aktionen. Um diese Aktionen ausführen zu können, muss das System in gewissen Abständen selbstständig auf die Datenbank zugreifen. In der Klasse ???? ist dafür ein eigener Wartungsthread implementiert.
\subsection{Starten und Stoppen der Anwendung}
\noindent \textbf{Start:} Beim Systemstart wird zunächst der oben beschriebene Logging-Mechanismus initialisiert. Im Anschluss liest das System die Konfigurationsdatei ein und versucht die dort angegebene Verbindung zur Datenbank. Bei erfolgreicher Verbindung wird überprüft, ob die benötigten Tabellennamen alle existieren bzw. legt diese bei deren Fehlen an. Sollte die Struktur der Tabellen fehlerhaft sein, wird eine Fehlermeldung geloggt und die Tabellen werden nicht vom System benutzt. Wenn die Datenbank fehlerhaft/nicht verbunden ist, werden eingehende Anfragen mit einer Fehlerseite beantwortet. Nach erfolgreichem Ablauf der vorhin genannten Prozesse wird als nächstes der Wartungsthread angestoßen, um fristenabhängige Aktionen durchzuführen. Danach ist das System vollständig betriebsbereit.\\
\textbf{Stop:} 
Beim planmäßigen Herunterfahren des Systems werden zunächst die noch offenen Datenbankverbindungen geschlossen und danach die Anwendung gestoppt. Dda dies sehr schnell passiert, wird währenddessen auf eine extra Umleitung der Nutzer auf eine Fehlerseite verzichtet. Da unsere SQL-Transaktionen dem ACID\footnote{Atomicity, Consistency, Isolation, Durability}-Prinzip folgen, wird die Datenbank jedoch auch beim Herunterfahren während eines Zugriffs in konsistentem Zustand hinterlassen. Nutzersessions überleben das Ausschalten des Servers nicht, d.h. alle eingeloggten Nutzer sind nach einem Neustart des Systems ausgeloggt. Wenn die Java Laufzeitumgebung des Systems plötzlich beendet wird und das System abstürzt, wird mittels einer sogenannten ShutdownHook trotzdem noch versucht, offene Datenbankverbindungen zu schließen. Dies ist bei einem Stromausfall allerdings unmöglich. 
%--Datenfluss--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Datenfluss}
\sectionauthor{Sergei Pravdin}

%--ER-Modell--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{ER-Modell}
\sectionauthor{Jonas Picker}

\subsection{Legende}
Jede Entität wird im Folgenden zusammen mit ihren nicht offensichtlichen Attributen und Relationen kurz beschrieben.\\
\textbf{Medium:} Diese Entität modelliert die in der Bibliothek gehaltenen Medien. Zusätzlich zum Primärschlüssel ist auch das Attribut 'Rückgabefrist' nicht vom Administrator entfernbar, die restlichen Attribute stellen den modifizierbaren Standartsatz der Medienattribute dar (PfHft /D020/). Erwähnenswert ist hier noch das als mehrwertig markierte Attribut 'Autoren', diese Markierung kann auch zu benutzerdefinierten Attributen hinzugefügt werden (PfHft. /F380/).\\
\textbf{Kategorie:} Die mit dieser Entität verbundenen Relationen ordnen jedem Medium maximal eine Kategorie zu und modellieren die Kategoriehierarchie (PfHft. /W440/) durch die Selbstbeziehung.\\
\textbf{Exemplar:} Von jedem Medium muss mindestens ein Exemplar vorhanden sein. Auch kann ein bestimmtes Exemplar von genau einem Nutzer zur Abholung markiert werden, diese Aktion (genau wie die Abholung oder Rückgabe) ändert den Verfügbarkeitsstatus und die dazugehörige Operationsfrist dementsprechend. \\
\textbf{Benutzer:} Ob ein Benutzer die Ausleihfunktion benutzen kann, wird durch das Attribut 'Ausleihstatus' modelliert. 'Accountstatus' zeigt hingegen an, ob der Nutzeraccount bereits den Verifizierungsprozess durchlaufen hat (PfHft. /W70/). Das Passwort wird in gehashter Form abgespeichert. \\
\textbf{Verifizierungslink:} Diese Entität kapselt einen befristet gültigen URL-Suffix aus dem der Verifizierungslink für genau einen Account erstellt wird.\\
\textbf{Zurücksetzungslink:} Identisch zur Entität 'Verifizierungslink' nur für die Passwortzurücksetzung.\\
\textbf{Anwendung:} Hier werden die setzbaren globalen Variablen und Anwendungseinstellungen gespeichert. Da die Tabelle nur einen Eintrag hat, wird auf einen Primärschlüssel verzichtet. 'Anonymer Zugang' modelliert die Berechtigungen anonymer Nutzer beim Besuchen des Webspaces (PfHft. /F10/), während 'Registrierungsstatus' eine nutzerfreundlichere Alternative als den RegEx zum Sperren der Registrierung bietet (PfHft. /F20/). 'Ausleihstatus' steht für das Umschalten des Systems zur manuellen Freischaltung der Ausleihfunktion für registrierter Nutzer. \\

%--Installationsanleitung-----------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Installationsanleitung}
\sectionauthor{Jonas Picker}
\subsection{Java Laufzeitumgebung}
Um dem Tomcat das finden der richtigen Laufzeitumgebung zu erleichter, sollte diese bereits vor dessen Installation auf Ihrem Server zu finden sein. Zum Zeitpunkt der Entwicklung ist aktuellste Version 16 noch nicht voll Kompatibel mit allen von uns verwendeten Werkzeugen. Wir verwenden daher die JDK 15.0.2. Wählen Sie bitte die passende Version für Ihr Betriebssystem aus \href{https://jdk.java.net/archive/}{dieser Liste} aus und laden Sie sie herunter. Da der Installationsprozess der offiziellen Java-Version der Firma Oracle sich etwas von dem der OpenJDK (welche ohne ausführliche Installationsanweisungen daherkommt) unterscheidet, sind hier Anleitungen von externen Quellen für die Betriebssysteme \href{https://www.codejava.net/java-se/download-and-install-openjdk-15}{Windows} \href{https://www.linuxfromscratch.org/blfs/view/svn/general/openjdk.html}{Linux} und \href{https://mkyong.com/java/how-to-install-java-on-mac-osx/}{macOS}. Erwähnenswert ist noch die Tatsache, dass der Tomcat als letztes Mittel die Umgebungsvariable JAVA\_HOME zum finden der JDK benutzt. Näheres entnehmen Sie bitte den Links im nun folgenden Abschnitt.
\subsection{Apache Tomcat}
Die Version 10.0.x des Apache Tomcat muss auf dem Server installiert sein. Die richtige Installationsanleitung für das auf dem Server installierte Betriebsystem ist unter \href{https://tomcat.apache.org/tomcat-10.0-doc/setup.html}{diesem Link} zu finden. Sie müssen die entsprechende Datei dann \href{https://tomcat.apache.org/download-10.cgi}{hier} herunterladen. Achten Sie besonders auf die Abschnitte, die das Setzen der Umgebungsvariablen CATALINA\_HOME und CATALINA\_BASE beschreiben.
\subsection{Registrieren des SSL-Zertifikats}
Um verschlüsselte Kundenkommunikation zu ermöglichen, muss auf dem Tomcat nun das geforderte SSL-Zertifikat initialisiert werden. Der genaue Ablauf ist mit weiteren Informationen zusammen unter \href{https://tomcat.apache.org/tomcat-10.0-doc/ssl-howto.html#Introduction_to_SSL}{diesem Link} zu finden.
\subsection{Aufspielen der Anwendung}
Unsere Applikation wird im .war-Format ausgeliefert, welches wie \href{https://tomcat.apache.org/tomcat-10.0-doc/deployer-howto.html#Deployment_on_Tomcat_startup}{hier} beschrieben auf verschiedenen Wegen auf den Tomcat Server aufgespielt ('deployed') werden kann. Wir empfehlen einen Weg zu wählen, der die Applikation nicht auf einen laufenden Tomcat aufspielt, da sonst wegen der noch leeren config.txt (siehe nächster Abschnitt) die Datenbankverbindung fehlschlagen kann und ein Neustart erforderlich ist.
\subsection{Verbindung zur Datenbank}
Unsere Applikation sollte nun unter dem Tomcat Installationsverzeichnis in einem Ordner zu finden sein. Navigieren Sie vor dem Start der Anwendung in den Ordner /WEB-INF und öffnen Sie das Textdokument config.txt. Sie finden dort Zeilen mit den Einträgen DB\_HOST, DB\_PORT, DB\_NAME, DB\_USER und DB\_PASSWORD. Befüllen Sie diese Zeilen nach dem Doppelpunkt mit einem Leerzeichen und folgenden Daten:
\begin{itemize}
\item DB\_HOST: Die URL unter der der Datenbankserver erreichbar ist
\item DB\_PORT: Der Port über den Anfragen an den Datenbankserver geleitet werden
\item DB\_NAME: Der Name der Datenbank am Server
\item DB\_USER: Der Name des Benutzers der Datenbank
\item DB\_PASSWORD: Das Passwort zum Benutzernamen
\end{itemize}
\subsection{Starten der Webanwendung}
Nun sollten alle nötigen Schritte zur Installation abgeschlossen sein und Sie können die Webanwendung z.B. auf dem direkten Weg starten, indem Sie im Verzeichnis der gesetzten Umgebungsvariable CATALINA\_HOME den Ordner /bin ansteuern und startup.sh aufrufen. Zum Abschalten des Tomcat wählen Sie dann shutdown.sh im gleichen Ordner.



\end{document}

